--[[
        Universal Scripts - Wersja z GUI stworzonym na podstawie dostarczonego kodu,
        z precyzyjnym pozycjonowaniem przycisków, dynamiczną widocznością przycisku MM2 w Premium,
        usuniętymi dopiskami "(Premium)" z nazw przycisków,
        oraz DYNAMICZNIE POZYCJONOWANYM PRZYCISKIEM "X" (jako ImageButton) jako bezpośrednie dziecko ScreenGui.
        Version 20.15 - Poprawnie zmniejszono rozmiar HideButton.
]]

local player = game.Players.LocalPlayer
local UserInputService = game:GetService("UserInputService")
local MarketplaceService = game:GetService("MarketplaceService")
local StarterGui = game:GetService("StarterGui")
local RunService = game:GetService("RunService")

local GAMEPASS_ID = 1296972626 -- JEDYNE ID Game Passa dla całego skryptu
local MM2_EXPERIENCE_ID = 142823291 -- Poprawne ID dla Murder Mystery 2

print("--- SKRYPT UNIVERSAL SCRIPTS START ---") -- DEBUG
print("Skrypt załadowany. ID Game Passa:", GAMEPASS_ID)
print("Twoje UserID:", player.UserId)
print("Aktualne Experience ID:", game.PlaceId)
print("Oczekiwane MM2 Experience ID:", MM2_EXPERIENCE_ID)
print("---")

-- Zmienna globalna do przechowywania statusu Game Passa
local hasGamePass = false
local initialGamePassCheckDone = false -- Nowa zmienna do kontrolowania początkowych powiadomień

-- Zmienna do przechowywania ostatniej pozycji HideButton, gdy MainFrame jest ukryte
-- Domyślna pozycja w prawym górnym rogu ekranu, z małym marginesem
local lastHideButtonPosition = UDim2.new(1, -55, 0, 10) 

local function sendNotification(title, text)
    StarterGui:SetCore("SendNotification", {
        Title = title,
        Text = text,
        Icon = "rbxassetid://102860171689689", -- ID obrazka wklejone ręcznie
        Duration = 5
    })
end

--- UI Instantiation ---
-- Instances (Zaktualizowane nazwy, aby pasowały do Twojego kodu)

local ScreenGui = Instance.new("ScreenGui")
local MainFrame = Instance.new("Frame") -- Zmieniono nazwę z Frame na MainFrame
local UICorner = Instance.new("UICorner")
local TabsFrame = Instance.new("Frame") -- Zmieniono nazwę z Frame_2 na TabsFrame
local HomeTabButton = Instance.new("TextButton") -- Zmieniono nazwę z HomeButton na HomeTabButton
local UICorner_2 = Instance.new("UICorner")
local UITextSizeConstraint = Instance.new("UITextSizeConstraint")
local UIAspectRatioConstraint = Instance.new("UIAspectRatioConstraint")
local PremiumTabButton = Instance.new("TextButton") -- Zmieniono nazwę z PremiumButton na PremiumTabButton
local UICorner_3 = Instance.new("UICorner")
local UITextSizeConstraint_2 = Instance.new("UITextSizeConstraint")
local UIAspectRatioConstraint_2 = Instance.new("UIAspectRatioConstraint")
local UICorner_4 = Instance.new("UICorner")
local UIAspectRatioConstraint_3 = Instance.new("UIAspectRatioConstraint")
local ScrollingFramePremium = Instance.new("ScrollingFrame")
local UICorner_5 = Instance.new("UICorner")
local SpectateButton_Premium = Instance.new("TextButton") -- Zmieniono nazwę ze SpectateButton na SpectateButton_Premium
local UICorner_6 = Instance.new("UICorner")
local UITextSizeConstraint_3 = Instance.new("UITextSizeConstraint")
local UIAspectRatioConstraint_4 = Instance.new("UIAspectRatioConstraint")
local MM2Button = Instance.new("TextButton")
local UICorner_7 = Instance.new("UICorner")
local UITextSizeConstraint_4 = Instance.new("UITextSizeConstraint")
local UIAspectRatioConstraint_5 = Instance.new("UIAspectRatioConstraint")
local FlyButton = Instance.new("TextButton") -- FlyButton z Twojego kodu był ConsoleButton w poprzednim
local UICorner_8 = Instance.new("UICorner")
local UITextSizeConstraint_5 = Instance.new("UITextSizeConstraint")
local UIAspectRatioConstraint_6 = Instance.new("UIAspectRatioConstraint")
local Invisibiltybutton = Instance.new("TextButton")
local UICorner_9 = Instance.new("UICorner")
local UITextSizeConstraint_6 = Instance.new("UITextSizeConstraint")
local UIAspectRatioConstraint_7 = Instance.new("UIAspectRatioConstraint")
local UIAspectRatioConstraint_8 = Instance.new("UIAspectRatioConstraint")
local TitleLabel = Instance.new("TextLabel") -- Zmieniono nazwę z TextLabel na TitleLabel
local UITextSizeConstraint_7 = Instance.new("UITextSizeConstraint")
local UIAspectRatioConstraint_9 = Instance.new("UIAspectRatioConstraint")
local ScrollingFrameHome = Instance.new("ScrollingFrame")
local SpeedToolbutton = Instance.new("TextButton")
local UICorner_10 = Instance.new("UICorner")
local UITextSizeConstraint_8 = Instance.new("UITextSizeConstraint")
local UIAspectRatioConstraint_10 = Instance.new("UIAspectRatioConstraint")
local ClicktptoolButton = Instance.new("TextButton")
local UICorner_11 = Instance.new("UICorner")
local UITextSizeConstraint_9 = Instance.new("UITextSizeConstraint")
local UIAspectRatioConstraint_11 = Instance.new("UIAspectRatioConstraint")
local UICorner_12 = Instance.new("UICorner")
local SpectateButton_Home = Instance.new("TextButton") -- Zmieniono nazwę ze SpectateButton_2 na SpectateButton_Home
local UICorner_13 = Instance.new("UICorner")
local UITextSizeConstraint_10 = Instance.new("UITextSizeConstraint")
local UIAspectRatioConstraint_12 = Instance.new("UIAspectRatioConstraint")
local NoclipButton = Instance.new("TextButton")
local UICorner_14 = Instance.new("UICorner")
local UITextSizeConstraint_11 = Instance.new("UITextSizeConstraint")
local UIAspectRatioConstraint_13 = Instance.new("UIAspectRatioConstraint")
local FlingButton = Instance.new("TextButton")
local UICorner_15 = Instance.new("UICorner")
local UITextSizeConstraint_12 = Instance.new("UITextSizeConstraint")
local UIAspectRatioConstraint_14 = Instance.new("UIAspectRatioConstraint")
local UIAspectRatioConstraint_15 = Instance.new("UIAspectRatioConstraint")
local UIAspectRatioConstraint_16 = Instance.new("UIAspectRatioConstraint")
local UIAspectRatioConstraint_17 = Instance.new("UIAspectRatioConstraint")
local HideButton = Instance.new("ImageButton") -- Zmieniono nazwę z ImageButton na HideButton

-- Properties (dopasowane do Twojego kodu GUI)

ScreenGui.Parent = player:WaitForChild("PlayerGui")
ScreenGui.ZIndexBehavior = Enum.ZIndexBehavior.Sibling
ScreenGui.ResetOnSpawn = false
ScreenGui.Enabled = true

MainFrame.Name = "MainFrame"
MainFrame.Parent = ScreenGui
MainFrame.BackgroundColor3 = Color3.new(0.172549, 0.172549, 0.172549)
MainFrame.BorderColor3 = Color3.new(0, 0, 0)
MainFrame.BorderSizePixel = 0
MainFrame.Position = UDim2.new(0.212787732, 0, 0.244107679, 0)
MainFrame.Size = UDim2.new(0.513162374, 0, 0.560262501, 0)
MainFrame.Draggable = true
MainFrame.Visible = true

UICorner.Parent = MainFrame

TabsFrame.Name = "TabsFrame"
TabsFrame.Parent = MainFrame
TabsFrame.BackgroundColor3 = Color3.new(0.141176, 0.141176, 0.141176)
TabsFrame.BorderColor3 = Color3.new(0, 0, 0)
TabsFrame.BorderSizePixel = 0
TabsFrame.Position = UDim2.new(0, 0, 3.34969492e-08, 0)
TabsFrame.Size = UDim2.new(0.21077837, 0, 0.998841524, 0)

HomeTabButton.Name = "HomeTabButton"
HomeTabButton.Parent = TabsFrame
HomeTabButton.BackgroundColor3 = Color3.new(0.419608, 0.419608, 0.419608)
HomeTabButton.BorderColor3 = Color3.new(0, 0, 0)
HomeTabButton.BorderSizePixel = 0
HomeTabButton.Position = UDim2.new(0.0591715984, 0, 0.112087913, 0)
HomeTabButton.Size = UDim2.new(0.881656826, 0, 0.083516486, 0)
HomeTabButton.Font = Enum.Font.SourceSans
HomeTabButton.Text = "Home"
HomeTabButton.TextColor3 = Color3.new(0, 0, 0)
HomeTabButton.TextScaled = true
HomeTabButton.TextSize = 14
HomeTabButton.TextWrapped = true

UICorner_2.Parent = HomeTabButton

UITextSizeConstraint.Parent = HomeTabButton
UITextSizeConstraint.MaxTextSize = 37

UIAspectRatioConstraint.Parent = HomeTabButton
UIAspectRatioConstraint.AspectRatio = 3.9210526943206787

PremiumTabButton.Name = "PremiumTabButton"
PremiumTabButton.Parent = TabsFrame
PremiumTabButton.BackgroundColor3 = Color3.new(0.419608, 0.419608, 0.419608)
PremiumTabButton.BorderColor3 = Color3.new(0, 0, 0)
PremiumTabButton.BorderSizePixel = 0
PremiumTabButton.Position = UDim2.new(0.0591715984, 0, 0.237362638, 0)
PremiumTabButton.Size = UDim2.new(0.881656826, 0, 0.083516486, 0)
PremiumTabButton.Font = Enum.Font.SourceSans
PremiumTabButton.Text = "Premium"
PremiumTabButton.TextColor3 = Color3.new(0, 0, 0)
PremiumTabButton.TextScaled = true
PremiumTabButton.TextSize = 14
PremiumTabButton.TextWrapped = true

UICorner_3.Parent = PremiumTabButton

UITextSizeConstraint_2.Parent = PremiumTabButton
UITextSizeConstraint_2.MaxTextSize = 37

UIAspectRatioConstraint_2.Parent = PremiumTabButton
UIAspectRatioConstraint_2.AspectRatio = 3.9210526943206787

UICorner_4.Parent = TabsFrame

UIAspectRatioConstraint_3.Parent = TabsFrame
UIAspectRatioConstraint_3.AspectRatio = 0.37142857909202576

ScrollingFramePremium.Name = "ScrollingFramePremium"
ScrollingFramePremium.Parent = MainFrame
ScrollingFramePremium.Active = true
ScrollingFramePremium.BackgroundColor3 = Color3.new(0.231373, 0.231373, 0.231373)
ScrollingFramePremium.BorderColor3 = Color3.new(0, 0, 0)
ScrollingFramePremium.BorderSizePixel = 0
ScrollingFramePremium.Position = UDim2.new(0.239610985, 0, 0.1111193, 0)
ScrollingFramePremium.Size = UDim2.new(0.733235598, 0, 0.864629686, 0)
ScrollingFramePremium.CanvasSize = UDim2.new(0,0,1.5,0) -- Dodano CanvasSize, jeśli brakuje
ScrollingFramePremium.Visible = false

UICorner_5.Parent = ScrollingFramePremium

SpectateButton_Premium.Name = "Spectate Button Premium"
SpectateButton_Premium.Parent = ScrollingFramePremium
SpectateButton_Premium.BackgroundColor3 = Color3.new(0.356863, 0.356863, 0.356863)
SpectateButton_Premium.BorderColor3 = Color3.new(0, 0, 0)
SpectateButton_Premium.Position = UDim2.new(0.0435483381, 0, 0.0257404726, 0)
SpectateButton_Premium.Size = UDim2.new(0, 150, 0, 38)
SpectateButton_Premium.Font = Enum.Font.SourceSans
SpectateButton_Premium.Text = "Spectate"
SpectateButton_Premium.TextColor3 = Color3.new(0, 0, 0)
SpectateButton_Premium.TextScaled = true
SpectateButton_Premium.TextSize = 14
SpectateButton_Premium.TextWrapped = true

UICorner_6.Parent = SpectateButton_Premium

UITextSizeConstraint_3.Parent = SpectateButton_Premium
UITextSizeConstraint_3.MaxTextSize = 37

UIAspectRatioConstraint_4.Parent = SpectateButton_Premium
UIAspectRatioConstraint_4.AspectRatio = 3.9473683834075928

MM2Button.Name = "MM2 Button"
MM2Button.Parent = ScrollingFramePremium
MM2Button.BackgroundColor3 = Color3.new(0.356863, 0.356863, 0.356863)
MM2Button.BorderColor3 = Color3.new(0, 0, 0)
MM2Button.Position = UDim2.new(0.619586229, 0, 0.0255702417, 0)
MM2Button.Size = UDim2.new(0, 150, 0, 38)
MM2Button.Font = Enum.Font.SourceSans
MM2Button.Text = "MM2"
MM2Button.TextColor3 = Color3.new(0, 0, 0)
MM2Button.TextScaled = true
MM2Button.TextSize = 14
MM2Button.TextWrapped = true
MM2Button.Visible = false -- Domyślnie niewidoczny

UICorner_7.Parent = MM2Button

UITextSizeConstraint_4.Parent = MM2Button
UITextSizeConstraint_4.MaxTextSize = 37

UIAspectRatioConstraint_5.Parent = MM2Button
UIAspectRatioConstraint_5.AspectRatio = 3.9473683834075928

FlyButton.Name = "Console Button" -- Zmieniono nazwę na "Console Button"
FlyButton.Parent = ScrollingFramePremium
FlyButton.BackgroundColor3 = Color3.new(0.356863, 0.356863, 0.356863)
FlyButton.BorderColor3 = Color3.new(0, 0, 0)
FlyButton.Position = UDim2.new(0.328718245, 0, 0.0258589424, 0)
FlyButton.Size = UDim2.new(0, 150, 0, 38)
FlyButton.Font = Enum.Font.SourceSans
FlyButton.Text = "Console"
FlyButton.TextColor3 = Color3.new(0, 0, 0)
FlyButton.TextScaled = true
FlyButton.TextSize = 14
FlyButton.TextWrapped = true

UICorner_8.Parent = FlyButton

UITextSizeConstraint_5.Parent = FlyButton
UITextSizeConstraint_5.MaxTextSize = 37

UIAspectRatioConstraint_6.Parent = FlyButton
UIAspectRatioConstraint_6.AspectRatio = 3.9473683834075928

Invisibiltybutton.Name = "Invisibilty Button"
Invisibiltybutton.Parent = ScrollingFramePremium
Invisibiltybutton.BackgroundColor3 = Color3.new(0.356863, 0.356863, 0.356863)
Invisibiltybutton.BorderColor3 = Color3.new(0, 0, 0)
Invisibiltybutton.Position = UDim2.new(0.042496033, 0, 0.0955808759, 0)
Invisibiltybutton.Size = UDim2.new(0, 150, 0, 38)
Invisibiltybutton.Font = Enum.Font.SourceSans
Invisibiltybutton.Text = "Invisibilty"
Invisibiltybutton.TextColor3 = Color3.new(0, 0, 0)
Invisibiltybutton.TextScaled = true
Invisibiltybutton.TextSize = 14
Invisibiltybutton.TextWrapped = true

UICorner_9.Parent = Invisibiltybutton

UITextSizeConstraint_6.Parent = Invisibiltybutton
UITextSizeConstraint_6.MaxTextSize = 37

UIAspectRatioConstraint_7.Parent = Invisibiltybutton
UIAspectRatioConstraint_7.AspectRatio = 3.9473683834075928

UIAspectRatioConstraint_8.Parent = ScrollingFramePremium
UIAspectRatioConstraint_8.AspectRatio = 1.4926543235778809

TitleLabel.Name = "TitleLabel"
TitleLabel.Parent = MainFrame
TitleLabel.BackgroundColor3 = Color3.new(1, 1, 1)
TitleLabel.BackgroundTransparency = 1
TitleLabel.BorderColor3 = Color3.new(0, 0, 0)
TitleLabel.BorderSizePixel = 0
TitleLabel.Position = UDim2.new(0.425298363, 0, 0.0153667927, 0)
TitleLabel.Size = UDim2.new(0.3616907, 0, 0.0724434555, 0)
TitleLabel.Font = Enum.Font.LuckiestGuy
TitleLabel.Text = "UNIVERSAL SCRIPTS"
TitleLabel.TextColor3 = Color3.new(1, 1, 1)
TitleLabel.TextScaled = true
TitleLabel.TextSize = 14
TitleLabel.TextWrapped = true

UITextSizeConstraint_7.Parent = TitleLabel
UITextSizeConstraint_7.MaxTextSize = 31

UIAspectRatioConstraint_9.Parent = TitleLabel
UIAspectRatioConstraint_9.AspectRatio = 8.78787899017334

ScrollingFrameHome.Name = "ScrollingFrameHome"
ScrollingFrameHome.Parent = MainFrame
ScrollingFrameHome.Active = true
ScrollingFrameHome.BackgroundColor3 = Color3.new(0.231373, 0.231373, 0.231373)
ScrollingFrameHome.BorderColor3 = Color3.new(0, 0, 0)
ScrollingFrameHome.BorderSizePixel = 0
ScrollingFrameHome.Position = UDim2.new(0.239610985, 0, 0.113314532, 0)
ScrollingFrameHome.Size = UDim2.new(0.733235598, 0, 0.864629686, 0)
ScrollingFrameHome.CanvasSize = UDim2.new(0,0,1.5,0) -- Dodano CanvasSize, jeśli brakuje

UICorner_12.Parent = ScrollingFrameHome

SpeedToolbutton.Name = "Speed Tool button"
SpeedToolbutton.Parent = ScrollingFrameHome
SpeedToolbutton.BackgroundColor3 = Color3.new(0.356863, 0.356863, 0.356863)
SpeedToolbutton.BorderColor3 = Color3.new(0, 0, 0)
SpeedToolbutton.Position = UDim2.new(0.0518765114, 0, 0.017869316, 0)
SpeedToolbutton.Size = UDim2.new(0, 150, 0, 38)
SpeedToolbutton.Font = Enum.Font.SourceSans
SpeedToolbutton.Text = "Speed Tool"
SpeedToolbutton.TextColor3 = Color3.new(0, 0, 0)
SpeedToolbutton.TextScaled = true
SpeedToolbutton.TextSize = 14
SpeedToolbutton.TextWrapped = true

UICorner_10.Parent = SpeedToolbutton

UITextSizeConstraint_8.Parent = SpeedToolbutton
UITextSizeConstraint_8.MaxTextSize = 37

UIAspectRatioConstraint_10.Parent = SpeedToolbutton
UIAspectRatioConstraint_10.AspectRatio = 3.9473683834075928

ClicktptoolButton.Name = "Click tp tool Button"
ClicktptoolButton.Parent = ScrollingFrameHome
ClicktptoolButton.BackgroundColor3 = Color3.new(0.356863, 0.356863, 0.356863)
ClicktptoolButton.BorderColor3 = Color3.new(0, 0, 0)
ClicktptoolButton.Position = UDim2.new(0.340883315, 0, 0.019441355, 0)
ClicktptoolButton.Size = UDim2.new(0, 150, 0, 38)
ClicktptoolButton.Font = Enum.Font.SourceSans
ClicktptoolButton.Text = "Click tp tool" -- Poprawiono literówkę z Twojego kodu (tp tool zamiast tp tool)
ClicktptoolButton.TextColor3 = Color3.new(0, 0, 0)
ClicktptoolButton.TextScaled = true
ClicktptoolButton.TextSize = 14
ClicktptoolButton.TextWrapped = true

UICorner_11.Parent = ClicktptoolButton

UITextSizeConstraint_9.Parent = ClicktptoolButton
UITextSizeConstraint_9.MaxTextSize = 35

UIAspectRatioConstraint_11.Parent = ClicktptoolButton
UIAspectRatioConstraint_11.AspectRatio = 3.9473683834075928

SpectateButton_Home.Name = "Spectate Button"
SpectateButton_Home.Parent = ScrollingFrameHome
SpectateButton_Home.BackgroundColor3 = Color3.new(0.356863, 0.356863, 0.356863)
SpectateButton_Home.BorderColor3 = Color3.new(0, 0, 0)
SpectateButton_Home.Position = UDim2.new(0.0527811497, 0, 0.0926060826, 0)
SpectateButton_Home.Size = UDim2.new(0, 150, 0, 38)
SpectateButton_Home.Font = Enum.Font.SourceSans
SpectateButton_Home.Text = "Spectate"
SpectateButton_Home.TextColor3 = Color3.new(0, 0, 0)
SpectateButton_Home.TextScaled = true
SpectateButton_Home.TextSize = 14
SpectateButton_Home.TextWrapped = true

UICorner_13.Parent = SpectateButton_Home

UITextSizeConstraint_10.Parent = SpectateButton_Home
UITextSizeConstraint_10.MaxTextSize = 37

UIAspectRatioConstraint_12.Parent = SpectateButton_Home
UIAspectRatioConstraint_12.AspectRatio = 3.9473683834075928

NoclipButton.Name = "Noclip Button"
NoclipButton.Parent = ScrollingFrameHome
NoclipButton.BackgroundColor3 = Color3.new(0.356863, 0.356863, 0.356863)
NoclipButton.BorderColor3 = Color3.new(0, 0, 0)
NoclipButton.Position = UDim2.new(0.654442132, 0, 0.017869316, 0)
NoclipButton.Size = UDim2.new(0, 150, 0, 38)
NoclipButton.Font = Enum.Font.SourceSans
NoclipButton.Text = "Noclip"
NoclipButton.TextColor3 = Color3.new(0, 0, 0)
NoclipButton.TextScaled = true
NoclipButton.TextSize = 14
NoclipButton.TextWrapped = true

UICorner_14.Parent = NoclipButton

UITextSizeConstraint_11.Parent = NoclipButton
UITextSizeConstraint_11.MaxTextSize = 37

UIAspectRatioConstraint_13.Parent = NoclipButton
UIAspectRatioConstraint_13.AspectRatio = 3.9473683834075928

FlingButton.Name = "Fling Button"
FlingButton.Parent = ScrollingFrameHome
FlingButton.BackgroundColor3 = Color3.new(0.356863, 0.356863, 0.356863)
FlingButton.BorderColor3 = Color3.new(0, 0, 0)
FlingButton.Position = UDim2.new(0.339192569, 0, 0.0893465802, 0)
FlingButton.Size = UDim2.new(0, 150, 0, 38)
FlingButton.Font = Enum.Font.SourceSans
FlingButton.Text = "Fling"
FlingButton.TextColor3 = Color3.new(0, 0, 0)
FlingButton.TextScaled = true
FlingButton.TextSize = 14
FlingButton.TextWrapped = true

UICorner_15.Parent = FlingButton

UITextSizeConstraint_12.Parent = FlingButton
UITextSizeConstraint_12.MaxTextSize = 37

UIAspectRatioConstraint_14.Parent = FlingButton
UIAspectRatioConstraint_14.AspectRatio = 3.9473683834075928

UIAspectRatioConstraint_15.Parent = ScrollingFrameHome
UIAspectRatioConstraint_15.AspectRatio = 1.4926543235778809

UIAspectRatioConstraint_16.Parent = MainFrame
UIAspectRatioConstraint_16.AspectRatio = 1.7601344585418701

UIAspectRatioConstraint_17.Parent = ScreenGui
UIAspectRatioConstraint_17.AspectRatio = 1.9216867685317993

HideButton.Name = "HideButton"
HideButton.Parent = ScreenGui
HideButton.BackgroundColor3 = Color3.new(1, 0, 0) -- Czerwone tło (możesz zmienić, jeśli Twój obrazek jest przezroczysty)
HideButton.BorderColor3 = Color3.new(0, 0, 0)
HideButton.BorderSizePixel = 3
HideButton.Image = "rbxassetid://102860171689689" -- ID obrazka wklejone ręcznie
HideButton.ImageColor3 = Color3.new(1, 1, 1) -- Kolor obrazu (biały, jeśli obraz jest czarny i chcesz, żeby był biały)
HideButton.ScaleType = Enum.ScaleType.Fit -- Dopasuj obrazek do rozmiar przycisku
HideButton.Position = UDim2.new(0.707863092, 0, 0.214006022, 0) -- Początkowa pozycja z Twojego kodu
HideButton.Size = UDim2.new(0, 30, 0, 30) -- ZMNIEJSZONO ROZMIAR TUTAJ!
HideButton.ZIndex = 5 -- Upewnij się, że jest na wierzchu
HideButton.Draggable = true -- Ważne: Przeciągalny!


--- Koniec UI Instantiation ---


--- Logika Skryptu ---

-- Funkcja do przełączania zakładek
local function showTab(tabName)
    print("DEBUG: Próbuję przełączyć na zakładkę:", tabName)
    ScrollingFrameHome.Visible = false
    ScrollingFramePremium.Visible = false

    if tabName == "Home" then
        ScrollingFrameHome.Visible = true
        print("DEBUG: Zakładka Home ustawiona na Visible = true")
    elseif tabName == "Premium" then
        if hasGamePass then
            ScrollingFramePremium.Visible = true
            print("DEBUG: Zakładka Premium ustawiona na Visible = true")
        else
            sendNotification("Universal Scripts", "Musisz posiadać wersje Premium, aby uzyskać dostęp do tej zakładki!.")
            print("DEBUG: Próba dostępu do zakładki Premium bez Game Passa. Wywołuję PromptGamePassPurchase.")
            MarketplaceService:PromptGamePassPurchase(player, GAMEPASS_ID)
        end
    end
end

-- Funkcja do sprawdzania statusu Game Passa
local function checkGamePassStatus()
    print("DEBUG: Sprawdzam status Game Passa (ID:", GAMEPASS_ID, ")...")
    local success, result = pcall(function()
        return MarketplaceService:UserOwnsGamePassAsync(player.UserId, GAMEPASS_ID)
    end)

    if success then
        hasGamePass = result
        print("DEBUG: Status Game Passa:", hasGamePass)
        if not initialGamePassCheckDone then
            if hasGamePass then
                sendNotification("Universal Scripts", "Posiadasz Game Pass! Funkcje Premium odblokowane.")
            else
                sendNotification("Universal Scripts", "Nie posiadasz wersji Premium. Wejdz na profil gry majka323pl's place i zakładke Passes/Przepustki aby go kupić.")
            end
            initialGamePassCheckDone = true
        end
    else
        warn("DEBUG: Błąd podczas sprawdzania Game Passa:", result)
        sendNotification("Universal Scripts", "Nie można sprawdzić statusu Game Passa. Spróbuj ponownie.")
    end
end

-- Funkcja do aktualizacji widoczności przycisku MM2 Premium
local function updateMM2ButtonVisibility()
    if game.PlaceId == MM2_EXPERIENCE_ID then
        MM2Button.Visible = true
        print("DEBUG: Jesteś w MM2 Experience, przycisk MM2 (Premium) jest WIDOCZNY.")
    else
        MM2Button.Visible = false
        print("DEBUG: Nie jesteś w MM2 Experience, przycisk MM2 (Premium) jest UKRYTY.")
    end
end

-- Funkcja do dynamicznego pozycjonowania przycisku "X" (HideButton)
local function updateHideButtonPosition()
    if MainFrame.Visible then
        -- Gdy MainFrame jest widoczne, ustaw HideButton w prawym górnym rogu MainFrame
        -- Używamy AbsolutePosition i AbsoluteSize dla dokładnego pozycjonowania
        local frameAbsolutePosition = MainFrame.AbsolutePosition
        local frameAbsoluteSize = MainFrame.AbsoluteSize
        local xButtonSize = HideButton.AbsoluteSize

        local xOffsetFromFrameRight = 5 -- piksele od prawej krawędzi MainFrame
        local yOffsetFromFrameTop = 5 -- piksele od górnej krawędzi MainFrame

        local newX = frameAbsolutePosition.X + frameAbsoluteSize.X - xButtonSize.X - xOffsetFromFrameRight
        local newY = frameAbsolutePosition.Y + yOffsetFromFrameTop
        HideButton.Position = UDim2.fromOffset(newX, newY)

        -- Zapisz tę pozycję jako ostatnią znaną, gdy GUI jest widoczne
        lastHideButtonPosition = HideButton.Position
        print("DEBUG: MainFrame widoczne. HideButton ustawiony na: ", HideButton.Position.X.Offset, HideButton.Position.Y.Offset)
    else
        -- Gdy MainFrame jest niewidoczne, HideButton przyjmuje ostatnią zapisaną pozycję
        -- Jeśli HideButton był przeciągany, jego ostatnia pozycja zostaje zachowana.
        -- Jeśli nie, wraca do domyślnej pozycji (prawy górny róg ekranu).
        HideButton.Position = lastHideButtonPosition
        print("DEBUG: MainFrame niewidoczne. HideButton ustawiony na zapisaną pozycję: ", HideButton.Position.X.Offset, HideButton.Position.Y.Offset)
    end
end


-- Sprawdzenie statusu Game Passa przy starcie skryptu
checkGamePassStatus()
updateMM2ButtonVisibility()
-- Domyślnie pokaż zakładkę Home
showTab("Home")
updateHideButtonPosition() -- Ustaw początkową pozycję przycisku "X"

-- Połączenie do zdarzenia PropertyChanged (dla HideButton.Position)
-- Zapisuje nową pozycję, gdy HideButton zostanie przeciągnięty
HideButton.Changed:Connect(function(property)
    if property == "Position" then
        if not MainFrame.Visible then -- Zapisuj nową pozycję tylko, gdy MainFrame jest ukryte
            lastHideButtonPosition = HideButton.Position
            -- print("DEBUG: HideButton Position zmienione na:", lastHideButtonPosition.X.Offset, lastHideButtonPosition.Y.Offset) -- Zbyt częste logowanie
        end
    end
end)


-- Pomocnicza funkcja do uruchamiania skryptów i wysyłania powiadomień
local function runScriptAndNotify(url, buttonName)
    local success, err = pcall(function()
        loadstring(game:HttpGet(url))()
    end)
    if success then
        sendNotification("Universal Scripts", "Skrypt '" .. buttonName .. "' załadowany!")
    else
        sendNotification("Universal Scripts", "Błąd ładowania skryptu '" .. buttonName .. "': " .. tostring(err))
        warn("Błąd ładowania skryptu '" .. buttonName .. "':", err)
    end
end

-- Połączenia przycisków Home
SpeedToolbutton.MouseButton1Click:Connect(function()
    print("DEBUG: Kliknięto przycisk Speed Tool (Home)")
    runScriptAndNotify("https://pastebin.com/raw/X7B0HPc2", SpeedToolbutton.Text)
end)

ClicktptoolButton.MouseButton1Click:Connect(function()
    print("DEBUG: Kliknięto przycisk Click tp tool (Home)")
    runScriptAndNotify("https://pastebin.com/raw/4KF2WJ9u", ClicktptoolButton.Text)
end)

SpectateButton_Home.MouseButton1Click:Connect(function()
    print("DEBUG: Kliknięto przycisk Spectate (Home)")
    runScriptAndNotify("https://pastebin.com/raw/UFVLWQRw", SpectateButton_Home.Text)
end)

NoclipButton.MouseButton1Click:Connect(function()
    print("DEBUG: Kliknięto przycisk Noclip (Home)")
    runScriptAndNotify("https://pastebin.com/raw/CnbYfaj1", NoclipButton.Text)
end)

FlingButton.MouseButton1Click:Connect(function()
    print("DEBUG: Kliknięto przycisk Fling (Home)")
    runScriptAndNotify('https://raw.githubusercontent.com/0Ben1/fe/main/obf_rf6iQURzu1fqrytcnLBAvW34C9N55kS9g9G3CKz086rC47M6632sEd4ZZYB0AYgV.lua.txt', FlingButton.Text)
end)

-- Połączenia przycisków Premium
SpectateButton_Premium.MouseButton1Click:Connect(function()
    print("DEBUG: Kliknięto przycisk Spectate (Premium). Sprawdzam Game Passa...")
    local success, currentHasGamePass = pcall(function()
        return MarketplaceService:UserOwnsGamePassAsync(player.UserId, GAMEPASS_ID)
    end)

    if success then
        print("DEBUG: Wynik sprawdzenia Game Passa (Spectate):", currentHasGamePass)
        if currentHasGamePass then
            runScriptAndNotify("https://pastebin.com/raw/UFVLWQRw", SpectateButton_Premium.Text)
        else
            sendNotification("Universal Scripts", "Musisz posiadać Wersje Premium, aby użyć tej funkcji!")
            print("DEBUG: Wywołuję PromptGamePassPurchase dla Spectate.")
            MarketplaceService:PromptGamePassPurchase(player, GAMEPASS_ID)
        end
    else
        warn("DEBUG: Błąd podczas sprawdzania Game Passa (Spectate):", currentHasGamePass)
        sendNotification("Universal Scripts", "Wystąpił błąd podczas sprawdzania czy masz wersje premium.")
    end
end)

MM2Button.MouseButton1Click:Connect(function()
    print("DEBUG: Kliknięto przycisk MM2 (Premium). Sprawdzam Game Passa...")
    local success, currentHasGamePass = pcall(function()
        return MarketplaceService:UserOwnsGamePassAsync(player.UserId, GAMEPASS_ID)
    end)

    if success then
        print("DEBUG: Wynik sprawdzenia Game Passa (MM2):", currentHasGamePass)
        if currentHasGamePass then
            runScriptAndNotify("https://raw.githubusercontent.com/vertex-peak/vertex/refs/heads/main/loadstring", MM2Button.Text)
        else
            sendNotification("Universal Scripts", "Musisz posiadać Game Pass, aby użyć tej funkcji!")
            print("DEBUG: Wywołuję PromptGamePassPurchase dla MM2.")
            MarketplaceService:PromptGamePassPurchase(player, GAMEPASS_ID)
        end
    else
        warn("DEBUG: Błąd podczas sprawdzania Game Passa (MM2):", currentHasGamePass)
        sendNotification("Universal Scripts", "Wystąpił błąd podczas sprawdzania czy masz wersje Premium.")
    end
end)

FlyButton.MouseButton1Click:Connect(function()
    print("DEBUG: Kliknięto przycisk Console (Premium). Sprawdzam Game Passa...")
    local success, currentHasGamePass = pcall(function()
        return MarketplaceService:UserOwnsGamePassAsync(player.UserId, GAMEPASS_ID)
    end)

    if success then
        print("DEBUG: Wynik sprawdzenia Game Passa (Console):", currentHasGamePass)
        if currentHasGamePass then
            runScriptAndNotify("https://raw.githubusercontent.com/EdgeIY/infiniteyield/master/source", FlyButton.Text)
        else
            sendNotification("Universal Scripts", "Musisz posiadać wersje Premium, aby użyć tej funkcji!")
            print("DEBUG: Wywołuję PromptGamePassPurchase dla Console.")
            MarketplaceService:PromptGamePassPurchase(player, GAMEPASS_ID)
        end
    else
        warn("DEBUG: Błąd podczas sprawdzania Game Passa (Console):", currentHasGamePass)
        sendNotification("Universal Scripts", "Wystąpił błąd podczas sprawdzania czy masz wersje Premium.")
    end
end)

Invisibiltybutton.MouseButton1Click:Connect(function()
    print("DEBUG: Kliknięto przycisk Invisibilty (Premium). Sprawdzam Game Passa...")
    local success, currentHasGamePass = pcall(function()
        return MarketplaceService:UserOwnsGamePassAsync(player.UserId, GAMEPASS_ID)
    end)

    if success then
        print("DEBUG: Wynik sprawdzenia Game Passa (Invisibilty):", currentHasGamePass)
        if currentHasGamePass then
            runScriptAndNotify('https://pastebin.com/raw/3Rnd9rHf', Invisibiltybutton.Text)
        else
            sendNotification("Universal Scripts", "Musisz posiadać Game Pass, aby użyć tej funkcji!")
            print("DEBUG: Wywołuję PromptGamePassPurchase dla Invisibilty.")
            MarketplaceService:PromptGamePassPurchase(player, GAMEPASS_ID)
        end
    else
        warn("DEBUG: Błąd podczas sprawdzania Game Passa (Invisibilty):", currentHasGamePass)
        sendNotification("Universal Scripts", "Wystąpił błąd podczas sprawdzania czy masz wersje Premium.")
    end
end)


-- Logika przycisków przełączających zakładki
HomeTabButton.MouseButton1Click:Connect(function()
    print("DEBUG: Kliknięto przycisk Home. Przełączam na Home.")
    showTab("Home")
end)

PremiumTabButton.MouseButton1Click:Connect(function()
    print("DEBUG: Kliknięto przycisk Premium. Przełączam na Premium lub otwieram okno zakupu.")
    showTab("Premium")
end)

HideButton.MouseButton1Click:Connect(function()
    print("DEBUG: Kliknięto przycisk Hide. Zmieniam widoczność MainFrame.")
    MainFrame.Visible = not MainFrame.Visible -- Ukrywa/pokazuje główną ramkę GUI
    -- Nie wywołujemy tutaj updateHideButtonPosition bezpośrednio,
    -- ponieważ MainFrame.VisibleChanged zajmie się tym
end)

-- Obsługa zdarzenia zmiany widoczności MainFrame
MainFrame.VisibleChanged:Connect(function()
    updateHideButtonPosition() -- Zawsze odświeżaj pozycję HideButton, gdy MainFrame zmienia widoczność
end)


-- Obsługa zdarzenia po zakończeniu próby zakupu Game Passa
MarketplaceService.PromptGamePassPurchaseFinished:Connect(function(userId, gamePassId, wasPurchased)
    print("DEBUG: Zdarzenie PromptGamePassPurchaseFinished: userId=", userId, " gamePassId=", gamePassId, " wasPurchased=", wasPurchased)
    if userId == player.UserId and gamePassId == GAMEPASS_ID then
        if wasPurchased then
            sendNotification("Universal Scripts", "Wersja Premium kupiona pomyślnie! Dziękujemy za zakup.")
            hasGamePass = true
            showTab("Premium")
        else
            sendNotification("Universal Scripts", "Anulowano zakup Wersji Premium.")
        end
    end
end)

-- Początkowe powiadomienie
spawn(function()
    task.wait(1)
    sendNotification("Universal Scripts", "Witaj w Universal Scripts! Skrypt załadowany.")
    print("--- SKRYPT UNIVERSAL SCRIPTS ZAKOŃCZONO INICJALIZACJĘ ---") -- DEBUG
end)

task.wait(0.5)
