local player = game.Players.LocalPlayer
local UserInputService = game:GetService("UserInputService")
local MarketplaceService = game:GetService("MarketplaceService")
local StarterGui = game:GetService("StarterGui")
local RunService = game:GetService("RunService")
local TeleportService = game:GetService("TeleportService")
local ReplicatedStorage = game:GetService("ReplicatedStorage") -- Dodano dla eventu PlaceIdChanged, choć używamy RunService

local GAMEPASS_ID = 1296972626
local MM2_EXPERIENCE_ID = 142823291 -- ID gry Murder Mystery 2
local TELEPORT_PLACE_ID = 6557073879 -- Id gry, do której teleportuje, jeśli nie ma gamepassa

local hasGamePass = false
local initialGamePassCheckDone = false

local lastHideButtonPosition = UDim2.new(1, -55, 0, 10) -- Domyślna pozycja dla HideButton

local function sendNotification(title, text)
    StarterGui:SetCore("SendNotification", {
        Title = title,
        Text = text,
        Icon = "rbxassetid://102860171689689", -- Upewnij się, że to ID zasobu jest prawidłowe i publiczne
        Duration = 5
    })
end

-- Tworzenie elementów GUI
local ScreenGui = Instance.new("ScreenGui")
ScreenGui.Name = "UniversalScriptsGUI"
ScreenGui.Parent = player:WaitForChild("PlayerGui")
ScreenGui.ZIndexBehavior = Enum.ZIndexBehavior.Sibling
ScreenGui.ResetOnSpawn = false
ScreenGui.Enabled = true

local MainFrame = Instance.new("Frame")
MainFrame.Name = "MainFrame"
MainFrame.Parent = ScreenGui
MainFrame.BackgroundColor3 = Color3.new(0.172549, 0.172549, 0.172549)
MainFrame.BorderColor3 = Color3.new(0, 0, 0)
MainFrame.BorderSizePixel = 0
MainFrame.Position = UDim2.new(0.212787732, 0, 0.244107679, 0)
MainFrame.Size = UDim2.new(0.513162374, 0, 0.560262501, 0)
MainFrame.Draggable = true
MainFrame.Visible = true

local UICorner_MainFrame = Instance.new("UICorner")
UICorner_MainFrame.Parent = MainFrame

local TabsFrame = Instance.new("Frame")
TabsFrame.Name = "TabsFrame"
TabsFrame.Parent = MainFrame
TabsFrame.BackgroundColor3 = Color3.new(0.141176, 0.141176, 0.141176)
TabsFrame.BorderColor3 = Color3.new(0, 0, 0)
TabsFrame.BorderSizePixel = 0
TabsFrame.Position = UDim2.new(0, 0, 3.349695e-8, 0)
TabsFrame.Size = UDim2.new(0.21077837, 0, 0.998841524, 0)

local HomeTabButton = Instance.new("TextButton")
HomeTabButton.Name = "HomeTabButton"
HomeTabButton.Parent = TabsFrame
HomeTabButton.BackgroundColor3 = Color3.new(0.419608, 0.419608, 0.419608)
HomeTabButton.BorderColor3 = Color3.new(0, 0, 0)
HomeTabButton.BorderSizePixel = 0
HomeTabButton.Position = UDim2.new(0.0591715984, 0, 0.112087913, 0)
HomeTabButton.Size = UDim2.new(0.881656826, 0, 0.083516486, 0)
HomeTabButton.Font = Enum.Font.SourceSans
HomeTabButton.Text = "Home"
HomeTabButton.TextColor3 = Color3.new(0, 0, 0)
HomeTabButton.TextScaled = true
HomeTabButton.TextSize = 14
HomeTabButton.TextWrapped = true

local UICorner_HomeTabButton = Instance.new("UICorner")
UICorner_HomeTabButton.Parent = HomeTabButton

local UITextSizeConstraint_HomeTabButton = Instance.new("UITextSizeConstraint")
UITextSizeConstraint_HomeTabButton.Parent = HomeTabButton
UITextSizeConstraint_HomeTabButton.MaxTextSize = 37

local UIAspectRatioConstraint_HomeTabButton = Instance.new("UIAspectRatioConstraint")
UIAspectRatioConstraint_HomeTabButton.Parent = HomeTabButton
UIAspectRatioConstraint_HomeTabButton.AspectRatio = 3.9210526943206787

local PremiumTabButton = Instance.new("TextButton")
PremiumTabButton.Name = "PremiumTabButton"
PremiumTabButton.Parent = TabsFrame
PremiumTabButton.BackgroundColor3 = Color3.new(0.419608, 0.419608, 0.419608)
PremiumTabButton.BorderColor3 = Color3.new(0, 0, 0)
PremiumTabButton.BorderSizePixel = 0
PremiumTabButton.Position = UDim2.new(0.0591715984, 0, 0.237362638, 0)
PremiumTabButton.Size = UDim2.new(0.881656826, 0, 0.083516486, 0)
PremiumTabButton.Font = Enum.Font.SourceSans
PremiumTabButton.Text = "Premium"
PremiumTabButton.TextColor3 = Color3.new(0, 0, 0)
PremiumTabButton.TextScaled = true
PremiumTabButton.TextSize = 14
PremiumTabButton.TextWrapped = true

local UICorner_PremiumTabButton = Instance.new("UICorner")
UICorner_PremiumTabButton.Parent = PremiumTabButton

local UITextSizeConstraint_PremiumTabButton = Instance.new("UITextSizeConstraint")
UITextSizeConstraint_PremiumTabButton.Parent = PremiumTabButton
UITextSizeConstraint_PremiumTabButton.MaxTextSize = 37

local UIAspectRatioConstraint_PremiumTabButton = Instance.new("UIAspectRatioConstraint")
UIAspectRatioConstraint_PremiumTabButton.Parent = PremiumTabButton
UIAspectRatioConstraint_PremiumTabButton.AspectRatio = 3.9210526943206787

local UICorner_TabsFrame = Instance.new("UICorner")
UICorner_TabsFrame.Parent = TabsFrame

local UIAspectRatioConstraint_TabsFrame = Instance.new("UIAspectRatioConstraint")
UIAspectRatioConstraint_TabsFrame.Parent = TabsFrame
UIAspectRatioConstraint_TabsFrame.AspectRatio = 0.37142857909202576

local ScrollingFramePremium = Instance.new("ScrollingFrame")
ScrollingFramePremium.Name = "ScrollingFramePremium"
ScrollingFramePremium.Parent = MainFrame
ScrollingFramePremium.Active = true
ScrollingFramePremium.BackgroundColor3 = Color3.new(0.231373, 0.231373, 0.231373)
ScrollingFramePremium.BorderColor3 = Color3.new(0, 0, 0)
ScrollingFramePremium.BorderSizePixel = 0
ScrollingFramePremium.Position = UDim2.new(0.239610985, 0, 0.1111193, 0)
ScrollingFramePremium.Size = UDim2.new(0.733235598, 0, 0.864629686, 0)
ScrollingFramePremium.CanvasSize = UDim2.new(0,0,1.5,0)
ScrollingFramePremium.Visible = false

local UICorner_ScrollingFramePremium = Instance.new("UICorner")
UICorner_ScrollingFramePremium.Parent = ScrollingFramePremium

local SpectateButton_Premium = Instance.new("TextButton")
SpectateButton_Premium.Name = "Spectate Button Premium"
SpectateButton_Premium.Parent = ScrollingFramePremium
SpectateButton_Premium.BackgroundColor3 = Color3.new(0.356863, 0.356863, 0.356863)
SpectateButton_Premium.BorderColor3 = Color3.new(0, 0, 0)
SpectateButton_Premium.Position = UDim2.new(0.0435483381, 0, 0.0257404726, 0)
SpectateButton_Premium.Size = UDim2.new(0, 150, 0, 38)
SpectateButton_Premium.Font = Enum.Font.SourceSans
SpectateButton_Premium.Text = "Spectate"
SpectateButton_Premium.TextColor3 = Color3.new(0, 0, 0)
SpectateButton_Premium.TextScaled = true
SpectateButton_Premium.TextSize = 14
SpectateButton_Premium.TextWrapped = true

local UICorner_SpectateButton_Premium = Instance.new("UICorner")
UICorner_SpectateButton_Premium.Parent = SpectateButton_Premium

local UITextSizeConstraint_SpectateButton_Premium = Instance.new("UITextSizeConstraint")
UITextSizeConstraint_SpectateButton_Premium.Parent = SpectateButton_Premium
UITextSizeConstraint_SpectateButton_Premium.MaxTextSize = 37

local UIAspectRatioConstraint_SpectateButton_Premium = Instance.new("UIAspectRatioConstraint")
UIAspectRatioConstraint_SpectateButton_Premium.Parent = SpectateButton_Premium
UIAspectRatioConstraint_SpectateButton_Premium.AspectRatio = 3.9473683834075928

local MM2Button = Instance.new("TextButton")
MM2Button.Name = "MM2 Button"
MM2Button.Parent = ScrollingFramePremium
MM2Button.BackgroundColor3 = Color3.new(0.356863, 0.356863, 0.356863)
MM2Button.BorderColor3 = Color3.new(0, 0, 0)
MM2Button.Position = UDim2.new(0.619586229, 0, 0.0255702417, 0)
MM2Button.Size = UDim2.new(0, 150, 0, 38)
MM2Button.Font = Enum.Font.SourceSans
MM2Button.Text = "MM2"
MM2Button.TextColor3 = Color3.new(0, 0, 0)
MM2Button.TextScaled = true
MM2Button.TextSize = 14
MM2Button.TextWrapped = true
MM2Button.Visible = false 

local UICorner_MM2Button = Instance.new("UICorner")
UICorner_MM2Button.Parent = MM2Button

local UITextSizeConstraint_MM2Button = Instance.new("UITextSizeConstraint")
UITextSizeConstraint_MM2Button.Parent = MM2Button
UITextSizeConstraint_MM2Button.MaxTextSize = 37

local UIAspectRatioConstraint_MM2Button = Instance.new("UIAspectRatioConstraint")
UIAspectRatioConstraint_MM2Button.Parent = MM2Button
UIAspectRatioConstraint_MM2Button.AspectRatio = 3.9473683834075928

local FlyButton = Instance.new("TextButton")
FlyButton.Name = "Console Button"
FlyButton.Parent = ScrollingFramePremium
FlyButton.BackgroundColor3 = Color3.new(0.356863, 0.356863, 0.356863)
FlyButton.BorderColor3 = Color3.new(0, 0, 0)
FlyButton.Position = UDim2.new(0.328718245, 0, 0.0258589424, 0)
FlyButton.Size = UDim2.new(0, 150, 0, 38)
FlyButton.Font = Enum.Font.SourceSans
FlyButton.Text = "Console"
FlyButton.TextColor3 = Color3.new(0, 0, 0)
FlyButton.TextScaled = true
FlyButton.TextSize = 14
FlyButton.TextWrapped = true

local UICorner_FlyButton = Instance.new("UICorner")
UICorner_FlyButton.Parent = FlyButton

local UITextSizeConstraint_FlyButton = Instance.new("UITextSizeConstraint")
UITextSizeConstraint_FlyButton.Parent = FlyButton
UITextSizeConstraint_FlyButton.MaxTextSize = 37

local UIAspectRatioConstraint_FlyButton = Instance.new("UIAspectRatioConstraint")
UIAspectRatioConstraint_FlyButton.Parent = FlyButton
UIAspectRatioConstraint_FlyButton.AspectRatio = 3.9473683834075928

local Invisibiltybutton = Instance.new("TextButton")
Invisibiltybutton.Name = "Invisibilty Button"
Invisibiltybutton.Parent = ScrollingFramePremium
Invisibiltybutton.BackgroundColor3 = Color3.new(0.356863, 0.356863, 0.356863)
Invisibiltybutton.BorderColor3 = Color3.new(0, 0, 0)
Invisibiltybutton.Position = UDim2.new(0.042496033, 0, 0.0955808759, 0)
Invisibiltybutton.Size = UDim2.new(0, 150, 0, 38)
Invisibiltybutton.Font = Enum.Font.SourceSans
Invisibiltybutton.Text = "Invisibilty"
Invisibiltybutton.TextColor3 = Color3.new(0, 0, 0)
Invisibiltybutton.TextScaled = true
Invisibiltybutton.TextSize = 14
Invisibiltybutton.TextWrapped = true

local UICorner_Invisibiltybutton = Instance.new("UICorner")
UICorner_Invisibiltybutton.Parent = Invisibiltybutton

local UITextSizeConstraint_Invisibiltybutton = Instance.new("UITextSizeConstraint")
UITextSizeConstraint_Invisibiltybutton.Parent = Invisibiltybutton
UITextSizeConstraint_Invisibiltybutton.MaxTextSize = 37

local UIAspectRatioConstraint_Invisibiltybutton = Instance.new("UIAspectRatioConstraint")
UIAspectRatioConstraint_Invisibiltybutton.Parent = Invisibiltybutton
UIAspectRatioConstraint_Invisibiltybutton.AspectRatio = 3.9473683834075928

-- Konfiguracja nowego przycisku GhostMM2
local GhostMM2Button = Instance.new("TextButton")
GhostMM2Button.Name = "GhostMM2 Button"
GhostMM2Button.Parent = ScrollingFramePremium
GhostMM2Button.BackgroundColor3 = Color3.new(0.356863, 0.356863, 0.356863)
GhostMM2Button.BorderColor3 = Color3.new(0, 0, 0)
GhostMM2Button.Position = UDim2.new(0.328718245, 0, 0.0955808759, 0) -- Pozycja obok Invisibilty
GhostMM2Button.Size = UDim2.new(0, 150, 0, 38)
GhostMM2Button.Font = Enum.Font.SourceSans
GhostMM2Button.Text = "GhostMM2"
GhostMM2Button.TextColor3 = Color3.new(0, 0, 0)
GhostMM2Button.TextScaled = true
GhostMM2Button.TextSize = 14
GhostMM2Button.TextWrapped = true
GhostMM2Button.Visible = false 

local UICorner_GhostMM2 = Instance.new("UICorner")
UICorner_GhostMM2.Parent = GhostMM2Button
local UITextSizeConstraint_GhostMM2 = Instance.new("UITextSizeConstraint")
UITextSizeConstraint_GhostMM2.Parent = GhostMM2Button
UITextSizeConstraint_GhostMM2.MaxTextSize = 37
local UIAspectRatioConstraint_GhostMM2 = Instance.new("UIAspectRatioConstraint")
UIAspectRatioConstraint_GhostMM2.Parent = GhostMM2Button
UIAspectRatioConstraint_GhostMM2.AspectRatio = 3.9473683834075928

local UIAspectRatioConstraint_ScrollingFramePremium = Instance.new("UIAspectRatioConstraint")
UIAspectRatioConstraint_ScrollingFramePremium.Parent = ScrollingFramePremium
UIAspectRatioConstraint_ScrollingFramePremium.AspectRatio = 1.4926543235778809

local TitleLabel = Instance.new("TextLabel")
TitleLabel.Name = "TitleLabel"
TitleLabel.Parent = MainFrame
TitleLabel.BackgroundColor3 = Color3.new(1, 1, 1)
TitleLabel.BackgroundTransparency = 1
TitleLabel.BorderColor3 = Color3.new(0, 0, 0)
TitleLabel.BorderSizePixel = 0
TitleLabel.Position = UDim2.new(0.425298363, 0, 0.0153667927, 0)
TitleLabel.Size = UDim2.new(0.3616907, 0, 0.0724434555, 0)
TitleLabel.Font = Enum.Font.LuckiestGuy
TitleLabel.Text = "UNIVERSAL SCRIPTS"
TitleLabel.TextColor3 = Color3.new(1, 1, 1)
TitleLabel.TextScaled = true
TitleLabel.TextSize = 14
TitleLabel.TextWrapped = true

local UITextSizeConstraint_TitleLabel = Instance.new("UITextSizeConstraint")
UITextSizeConstraint_TitleLabel.Parent = TitleLabel
UITextSizeConstraint_TitleLabel.MaxTextSize = 31

local UIAspectRatioConstraint_TitleLabel = Instance.new("UIAspectRatioConstraint")
UIAspectRatioConstraint_TitleLabel.Parent = TitleLabel
UIAspectRatioConstraint_TitleLabel.AspectRatio = 8.78787899017334

local ScrollingFrameHome = Instance.new("ScrollingFrame")
ScrollingFrameHome.Name = "ScrollingFrameHome"
ScrollingFrameHome.Parent = MainFrame
ScrollingFrameHome.Active = true
ScrollingFrameHome.BackgroundColor3 = Color3.new(0.231373, 0.231373, 0.231373)
ScrollingFrameHome.BorderColor3 = Color3.new(0, 0, 0)
ScrollingFrameHome.BorderSizePixel = 0
ScrollingFrameHome.Position = UDim2.new(0.239610985, 0, 0.113314532, 0)
ScrollingFrameHome.Size = UDim2.new(0.733235598, 0, 0.864629686, 0)
ScrollingFrameHome.CanvasSize = UDim2.new(0,0,1.5,0)

local UICorner_ScrollingFrameHome = Instance.new("UICorner")
UICorner_ScrollingFrameHome.Parent = ScrollingFrameHome

local SpeedToolbutton = Instance.new("TextButton")
SpeedToolbutton.Name = "Speed Tool button"
SpeedToolbutton.Parent = ScrollingFrameHome
SpeedToolbutton.BackgroundColor3 = Color3.new(0.356863, 0.356863, 0.356863)
SpeedToolbutton.BorderColor3 = Color3.new(0, 0, 0)
SpeedToolbutton.Position = UDim2.new(0.0518765114, 0, 0.017869316, 0)
SpeedToolbutton.Size = UDim2.new(0, 150, 0, 38)
SpeedToolbutton.Font = Enum.Font.SourceSans
SpeedToolbutton.Text = "Speed Tool"
SpeedToolbutton.TextColor3 = Color3.new(0, 0, 0)
SpeedToolbutton.TextScaled = true
SpeedToolbutton.TextSize = 14
SpeedToolbutton.TextWrapped = true

local UICorner_SpeedToolbutton = Instance.new("UICorner")
UICorner_SpeedToolbutton.Parent = SpeedToolbutton

local UITextSizeConstraint_SpeedToolbutton = Instance.new("UITextSizeConstraint")
UITextSizeConstraint_SpeedToolbutton.Parent = SpeedToolbutton
UITextSizeConstraint_SpeedToolbutton.MaxTextSize = 37

local UIAspectRatioConstraint_SpeedToolbutton = Instance.new("UIAspectRatioConstraint")
UIAspectRatioConstraint_SpeedToolbutton.Parent = SpeedToolbutton
UIAspectRatioConstraint_SpeedToolbutton.AspectRatio = 3.9473683834075928

local ClicktptoolButton = Instance.new("TextButton")
ClicktptoolButton.Name = "Click tp tool Button"
ClicktptoolButton.Parent = ScrollingFrameHome
ClicktptoolButton.BackgroundColor3 = Color3.new(0.356863, 0.356863, 0.356863)
ClicktptoolButton.BorderColor3 = Color3.new(0, 0, 0)
ClicktptoolButton.Position = UDim2.new(0.340883315, 0, 0.019441355, 0)
ClicktptoolButton.Size = UDim2.new(0, 150, 0, 38)
ClicktptoolButton.Font = Enum.Font.SourceSans
ClicktptoolButton.Text = "Click tp tool"
ClicktptoolButton.TextColor3 = Color3.new(0, 0, 0)
ClicktptoolButton.TextScaled = true
ClicktptoolButton.TextSize = 14
ClicktptoolButton.TextWrapped = true

local UICorner_ClicktptoolButton = Instance.new("UICorner")
UICorner_ClicktptoolButton.Parent = ClicktptoolButton

local UITextSizeConstraint_ClicktptoolButton = Instance.new("UITextSizeConstraint")
UITextSizeConstraint_ClicktptoolButton.Parent = ClicktptoolButton
UITextSizeConstraint_ClicktptoolButton.MaxTextSize = 35

local UIAspectRatioConstraint_ClicktptoolButton = Instance.new("UIAspectRatioConstraint")
UIAspectRatioConstraint_ClicktptoolButton.Parent = ClicktptoolButton
UIAspectRatioConstraint_ClicktptoolButton.AspectRatio = 3.9473683834075928

local SpectateButton_Home = Instance.new("TextButton")
SpectateButton_Home.Name = "Spectate Button"
SpectateButton_Home.Parent = ScrollingFrameHome
SpectateButton_Home.BackgroundColor3 = Color3.new(0.356863, 0.356863, 0.356863)
SpectateButton_Home.BorderColor3 = Color3.new(0, 0, 0)
SpectateButton_Home.Position = UDim2.new(0.0527811497, 0, 0.0926060826, 0)
SpectateButton_Home.Size = UDim2.new(0, 150, 0, 38)
SpectateButton_Home.Font = Enum.Font.SourceSans
SpectateButton_Home.Text = "Spectate"
SpectateButton_Home.TextColor3 = Color3.new(0, 0, 0)
SpectateButton_Home.TextScaled = true
SpectateButton_Home.TextSize = 14
SpectateButton_Home.TextWrapped = true

local UICorner_SpectateButton_Home = Instance.new("UICorner")
UICorner_SpectateButton_Home.Parent = SpectateButton_Home

local UITextSizeConstraint_SpectateButton_Home = Instance.new("UITextSizeConstraint")
UITextSizeConstraint_SpectateButton_Home.Parent = SpectateButton_Home
UITextSizeConstraint_SpectateButton_Home.MaxTextSize = 37

local UIAspectRatioConstraint_SpectateButton_Home = Instance.new("UIAspectRatioConstraint")
UIAspectRatioConstraint_SpectateButton_Home.Parent = SpectateButton_Home
UIAspectRatioConstraint_SpectateButton_Home.AspectRatio = 3.9473683834075928

local NoclipButton = Instance.new("TextButton")
NoclipButton.Name = "Noclip Button"
NoclipButton.Parent = ScrollingFrameHome
NoclipButton.BackgroundColor3 = Color3.new(0.356863, 0.356863, 0.356863)
NoclipButton.BorderColor3 = Color3.new(0, 0, 0)
NoclipButton.Position = UDim2.new(0.654442132, 0, 0.017869316, 0)
NoclipButton.Size = UDim2.new(0, 150, 0, 38)
NoclipButton.Font = Enum.Font.SourceSans
NoclipButton.Text = "Noclip"
NoclipButton.TextColor3 = Color3.new(0, 0, 0)
NoclipButton.TextScaled = true
NoclipButton.TextSize = 14
NoclipButton.TextWrapped = true

local UICorner_NoclipButton = Instance.new("UICorner")
UICorner_NoclipButton.Parent = NoclipButton

local UITextSizeConstraint_NoclipButton = Instance.new("UITextSizeConstraint")
UITextSizeConstraint_NoclipButton.Parent = NoclipButton
UITextSizeConstraint_NoclipButton.MaxTextSize = 37

local UIAspectRatioConstraint_NoclipButton = Instance.new("UIAspectRatioConstraint")
UIAspectRatioConstraint_NoclipButton.Parent = NoclipButton
UIAspectRatioConstraint_NoclipButton.AspectRatio = 3.9473683834075928

local FlingButton = Instance.new("TextButton")
FlingButton.Name = "Fling Button"
FlingButton.Parent = ScrollingFrameHome
FlingButton.BackgroundColor3 = Color3.new(0.356863, 0.356863, 0.356863)
FlingButton.BorderColor3 = Color3.new(0, 0, 0)
FlingButton.Position = UDim2.new(0.339192569, 0, 0.0893465802, 0)
FlingButton.Size = UDim2.new(0, 150, 0, 38)
FlingButton.Font = Enum.Font.SourceSans
FlingButton.Text = "Fling"
FlingButton.TextColor3 = Color3.new(0, 0, 0)
FlingButton.TextScaled = true
FlingButton.TextSize = 14
FlingButton.TextWrapped = true

local UICorner_FlingButton = Instance.new("UICorner")
UICorner_FlingButton.Parent = FlingButton

local UITextSizeConstraint_FlingButton = Instance.new("UITextSizeConstraint")
UITextSizeConstraint_FlingButton.Parent = FlingButton
UITextSizeConstraint_FlingButton.MaxTextSize = 37

local UIAspectRatioConstraint_FlingButton = Instance.new("UIAspectRatioConstraint")
UIAspectRatioConstraint_FlingButton.Parent = FlingButton
UIAspectRatioConstraint_FlingButton.AspectRatio = 3.9473683834075928

local UIAspectRatioConstraint_ScrollingFrameHome = Instance.new("UIAspectRatioConstraint")
UIAspectRatioConstraint_ScrollingFrameHome.Parent = ScrollingFrameHome
UIAspectRatioConstraint_ScrollingFrameHome.AspectRatio = 1.4926543235778809

local UIAspectRatioConstraint_MainFrame = Instance.new("UIAspectRatioConstraint")
UIAspectRatioConstraint_MainFrame.Parent = MainFrame
UIAspectRatioConstraint_MainFrame.AspectRatio = 1.7601344585418701

local UIAspectRatioConstraint_ScreenGui = Instance.new("UIAspectRatioConstraint")
UIAspectRatioConstraint_ScreenGui.Parent = ScreenGui
UIAspectRatioConstraint_ScreenGui.AspectRatio = 1.9216867685317993

local HideButton = Instance.new("ImageButton")
HideButton.Name = "HideButton"
HideButton.Parent = ScreenGui
HideButton.BackgroundColor3 = Color3.new(1, 0, 0)
HideButton.BorderColor3 = Color3.new(0, 0, 0)
HideButton.BorderSizePixel = 3
HideButton.Image = "rbxassetid://102860171689689"
HideButton.ImageColor3 = Color3.new(1, 1, 1)
HideButton.ScaleType = Enum.ScaleType.Fit
HideButton.Position = UDim2.new(0.707863092, 0, 0.214006022, 0)
HideButton.Size = UDim2.new(0, 30, 0, 30)
HideButton.ZIndex = 5
HideButton.Draggable = true

---
## Funkcje pomocnicze
---

local function showTab(tabName)
    ScrollingFrameHome.Visible = false
    ScrollingFramePremium.Visible = false

    if tabName == "Home" then
        ScrollingFrameHome.Visible = true
    elseif tabName == "Premium" then
        if hasGamePass then
            ScrollingFramePremium.Visible = true
        else
            sendNotification("Universal Scripts", "Musisz posiadać wersję premium, aby uzyskać dostęp do tej zakładki!")
            -- Jeśli chcesz teleportować, to tylko w kliencie (executorze)
            -- TeleportService:Teleport(TELEPORT_PLACE_ID, player) -- Ta linia może powodować problemy w niektórych executorach
            -- MainFrame.Visible = false -- Ukryj GUI po teleportacji, jeśli teleportacja ma miejsce
        end
    end
end

local function checkGamePassStatus()
    local success, result = pcall(function()
        return MarketplaceService:UserOwnsGamePassAsync(player.UserId, GAMEPASS_ID)
    end)

    if success then
        hasGamePass = result
        if not initialGamePassCheckDone then
            if hasGamePass then
                sendNotification("Universal Scripts", "Posiadasz wersję premium! Funkcje Premium odblokowane.")
            else
                sendNotification("Universal Scripts", "Nie posiadasz wersji premium. Kliknij zakładkę Premium, aby przejść do zakupu.")
            end
            initialGamePassCheckDone = true
        end
    else
        warn("Błąd podczas sprawdzania wersji premium:", result)
        sendNotification("Universal Scripts", "Nie można sprawdzić statusu wersji premium. Spróbuj ponownie.")
    end
end

local function updateMM2ButtonVisibility()
    -- Ustawia widoczność obu przycisków MM2/GhostMM2 w zależności od PlaceId
    if game.PlaceId == MM2_EXPERIENCE_ID then
        MM2Button.Visible = true
        GhostMM2Button.Visible = true
    else
        MM2Button.Visible = false
        GhostMM2Button.Visible = false
    end
end

local function updateHideButtonPosition()
    -- Ta funkcja aktualizuje pozycję przycisku HideButton obok MainFrame
    if MainFrame.Visible then
        local frameAbsolutePosition = MainFrame.AbsolutePosition
        local frameAbsoluteSize = MainFrame.AbsoluteSize
        local xButtonSize = HideButton.AbsoluteSize

        local xOffsetFromFrameRight = 5
        local yOffsetFromFrameTop = 5

        local newX = frameAbsolutePosition.X + frameAbsoluteSize.X - xButtonSize.X - xOffsetFromFrameRight
        local newY = frameAbsolutePosition.Y + yOffsetFromFrameTop
        HideButton.Position = UDim2.fromOffset(newX, newY)

        lastHideButtonPosition = HideButton.Position -- Zapisz ostatnią pozycję widocznego przycisku
    else
        -- Jeśli MainFrame jest niewidoczny, przycisk HideButton powinien być tam, gdzie był ostatnio
        -- (lub w jakiejś domyślnej pozycji, jeśli nie było wcześniejszej)
        HideButton.Position = lastHideButtonPosition
    end
end

local function runScriptAndNotify(url, buttonName)
    local success, err = pcall(function()
        loadstring(game:HttpGet(url))()
    end)
    if success then
        sendNotification("Universal Scripts", "Skrypt '" .. buttonName .. "' załadowany!")
    else
        sendNotification("Universal Scripts", "Błąd ładowania skryptu '" .. buttonName .. "': " .. tostring(err))
        warn("Błąd ładowania skryptu '" .. buttonName .. "':", err)
    end
end

---
## Obsługa zdarzeń (Event Handling)
---

SpeedToolbutton.MouseButton1Click:Connect(function()
    runScriptAndNotify("https://pastebin.com/raw/X7B0HPc2", SpeedToolbutton.Text)
end)

ClicktptoolButton.MouseButton1Click:Connect(function()
    runScriptAndNotify("https://pastebin.com/raw/4KF2WJ9u", ClicktptoolButton.Text)
end)

SpectateButton_Home.MouseButton1Click:Connect(function()
    runScriptAndNotify("https://pastebin.com/raw/UFVLWQRw", SpectateButton_Home.Text)
end)

NoclipButton.MouseButton1Click:Connect(function()
    runScriptAndNotify("https://pastebin.com/raw/CnbYfaj1", NoclipButton.Text)
end)

FlingButton.MouseButton1Click:Connect(function()
    runScriptAndNotify('https://raw.githubusercontent.com/0Ben1/fe/main/obf_rf6iQURzu1fqrytcnLBAvW34C9N55kS9g9G3CKz086rC47M6632sEd4ZZYB0AYgV.lua.txt', FlingButton.Text)
end)

SpectateButton_Premium.MouseButton1Click:Connect(function()
    local success, currentHasGamePass = pcall(function()
        return MarketplaceService:UserOwnsGamePassAsync(player.UserId, GAMEPASS_ID)
    end)

    if success then
        if currentHasGamePass then
            runScriptAndNotify("https://pastebin.com/raw/UFVLWQRw", SpectateButton_Premium.Text)
        else
            sendNotification("Universal Scripts", "Musisz posiadać wersję premium, aby użyć tej funkcji!")
            MarketplaceService:PromptGamePassPurchase(player, GAMEPASS_ID)
        end
    else
        warn("Błąd podczas sprawdzania wersji premium (Spectate):", currentHasGamePass)
        sendNotification("Universal Scripts", "Wystąpił błąd podczas sprawdzania wersji premium.")
    end
end)

MM2Button.MouseButton1Click:Connect(function()
    local success, currentHasGamePass = pcall(function()
        return MarketplaceService:UserOwnsGamePassAsync(player.UserId, GAMEPASS_ID)
    end)

    if success then
        if currentHasGamePass then
            runScriptAndNotify("https://raw.githubusercontent.com/vertex-peak/vertex/refs/heads/main/loadstring", MM2Button.Text)
        else
            sendNotification("Universal Scripts", "Musisz posiadać wersję premium, aby użyć tej funkcji!")
            MarketplaceService:PromptGamePassPurchase(player, GAMEPASS_ID)
        end
    else
        warn("Błąd podczas sprawdzania wersji premium (MM2):", currentHasGamePass)
        sendNotification("Universal Scripts", "Wystąpił błąd podczas sprawdzania wersji premium.")
    end
end)

FlyButton.MouseButton1Click:Connect(function()
    local success, currentHasGamePass = pcall(function()
        return MarketplaceService:UserOwnsGamePassAsync(player.UserId, GAMEPASS_ID)
    end)

    if success then
        if currentHasGamePass then
            runScriptAndNotify("https://raw.githubusercontent.com/EdgeIY/infiniteyield/master/source", FlyButton.Text)
        else
            sendNotification("Universal Scripts", "Musisz posiadać wersję premium, aby użyć tej funkcji!")
            MarketplaceService:PromptGamePassPurchase(player, GAMEPASS_ID)
        end
    else
        warn("Błąd podczas sprawdzania wersji premium (Console):", currentHasGamePass)
        sendNotification("Universal Scripts", "Wystąpił błąd podczas sprawdzania wersji premium.")
    end
end)

Invisibiltybutton.MouseButton1Click:Connect(function()
    local success, currentHasGamePass = pcall(function()
        return MarketplaceService:UserOwnsGamePassAsync(player.UserId, GAMEPASS_ID)
    end)

    if success then
        if currentHasGamePass then
            runScriptAndNotify('https://pastebin.com/raw/3Rnd9rHf', Invisibiltybutton.Text)
        else
            sendNotification("Universal Scripts", "Musisz posiadać wersję premium, aby użyć tej funkcji!")
            MarketplaceService:PromptGamePassPurchase(player, GAMEPASS_ID)
        end
    else
        warn("Błąd podczas sprawdzania wersji premium (Invisibilty):", currentHasGamePass)
        sendNotification("Universal Scripts", "Wystąpił błąd podczas sprawdzania wersji premium.")
    end
end)

-- Obsługa nowego przycisku GhostMM2
GhostMM2Button.MouseButton1Click:Connect(function()
    local success, currentHasGamePass = pcall(function()
        return MarketplaceService:UserOwnsGamePassAsync(player.UserId, GAMEPASS_ID)
    end)

    if success then
        if currentHasGamePass then
            runScriptAndNotify("https://raw.githubusercontent.com/GhostPlayer352/Test4/main/Murder%20Mystery", GhostMM2Button.Text)
        else
            sendNotification("Universal Scripts", "Musisz posiadać wersję premium, aby użyć tej funkcji!")
            MarketplaceService:PromptGamePassPurchase(player, GAMEPASS_ID)
        end
    else
        warn("Błąd podczas sprawdzania wersji premium (GhostMM2):", currentHasGamePass)
        sendNotification("Universal Scripts", "Wystąpił błąd podczas sprawdzania wersji premium.")
    end
end)

HomeTabButton.MouseButton1Click:Connect(function()
    showTab("Home")
end)

PremiumTabButton.MouseButton1Click:Connect(function()
    showTab("Premium")
end)

HideButton.MouseButton1Click:Connect(function()
    MainFrame.Visible = not MainFrame.Visible
    updateHideButtonPosition() -- Zaktualizuj pozycję po zmianie widoczności
end)

-- Jeśli MainFrame jest przenoszony, zaktualizuj pozycję HideButton
MainFrame.Change.Position:Connect(function()
    if MainFrame.Visible then -- Tylko jeśli MainFrame jest widoczny i jest przenoszony
        updateHideButtonPosition()
    end
end)

MainFrame.VisibleChanged:Connect(function()
    updateHideButtonPosition()
end)

-- Dodano nasłuchiwanie na zmianę PlaceId, aby aktualizować widoczność przycisków MM2/GhostMM2
local lastPlaceId = game.PlaceId
-- Używamy RunService.Stepped do częstego sprawdzania PlaceId, jeśli PlaceIdChanged nie jest dostępne
RunService.Stepped:Connect(function()
    if game.PlaceId ~= lastPlaceId then
        lastPlaceId = game.PlaceId
        updateMM2ButtonVisibility()
        -- Jeśli zakładka Premium jest aktywna i zmieniliśmy grę, upewnij się, że przyciski są ukryte
        if ScrollingFramePremium.Visible then
            showTab("Premium") -- Odśwież zakładkę Premium, żeby ukryć przyciski jeśli to nie MM2
        end
    end
end)

-- Dodatkowo, sprawdź przy zmianie postaci (np. po śmierci)
player.CharacterAdded:Connect(function()
    updateMM2ButtonVisibility()
end)

-- Sprawdź widoczność po załadowaniu gry
game.Loaded:Connect(function()
    updateMM2ButtonVisibility()
end)

MarketplaceService.PromptGamePassPurchaseFinished:Connect(function(userId, gamePassId, wasPurchased)
    if userId == player.UserId and gamePassId == GAMEPASS_ID then
        if wasPurchased then
            sendNotification("Universal Scripts", "Wersja premium kupiona pomyślnie! Dziękujemy za zakup.")
            hasGamePass = true
            showTab("Premium")
        else
            sendNotification("Universal Scripts", "Anulowano zakup wersji premium.")
        end
    end
end)

---
## Początkowe uruchomienie
---

spawn(function()
    -- Zwiększono czas oczekiwania, aby dać Robloxowi więcej czasu na załadowanie GUI
    task.wait(2)
    sendNotification("Universal Scripts", "Witaj w Universal Scripts! Skrypt załadowany.")
    checkGamePassStatus()
    updateMM2ButtonVisibility()
    showTab("Home") -- Domyślnie pokaż zakładkę Home
    updateHideButtonPosition() -- Ustaw początkową pozycję przycisku ukrycia
end)
