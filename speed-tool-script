-- Ustawienia początkowe
local player = game.Players.LocalPlayer
local character = player.Character or player.CharacterAdded:Wait()
local humanoid = character:WaitForChild("Humanoid")

---
## NOWE GUI (wygenerowane z Gui2Lua, z poprawionymi nazwami i dodaną właściwością 'Active')
---

local ScreenGui = Instance.new("ScreenGui")
local Frame = Instance.new("Frame")
local TextLabel = Instance.new("TextLabel")
local UICorner = Instance.new("UICorner")
local SpeedInput = Instance.new("TextBox") -- Zmieniono nazwę zmiennej z Prdko na SpeedInput
local UICorner_2 = Instance.new("UICorner")
local Button = Instance.new("TextButton") -- Zmieniono nazwę zmiennej z UstawPrdkoButton na Button
local UICorner_3 = Instance.new("UICorner")
local SaveSpeedButton = Instance.new("TextButton") -- Zmieniono nazwę zmiennej z ZapiszPrdkoButton na SaveSpeedButton
local UICorner_4 = Instance.new("UICorner")
local UIAspectRatioConstraint = Instance.new("UIAspectRatioConstraint")

-- Właściwości i hierarchia GUI
ScreenGui.Parent = player:WaitForChild("PlayerGui")
ScreenGui.ZIndexBehavior = Enum.ZIndexBehavior.Sibling

Frame.Parent = ScreenGui
Frame.BackgroundColor3 = Color3.new(0.356863, 0.356863, 0.356863)
Frame.BackgroundTransparency = 0.30000001192092896
Frame.BorderColor3 = Color3.new(0, 0, 0)
Frame.BorderSizePixel = 5
Frame.Position = UDim2.new(0.784961402, 0, 0.430471897, 0)
Frame.Size = UDim2.new(0, 293, 0, 343)
Frame.Active = true -- Kluczowe: Umożliwia przeciąganie i obsługę dotyku!

TextLabel.Parent = Frame
TextLabel.BackgroundColor3 = Color3.new(1, 1, 1)
TextLabel.BackgroundTransparency = 1
TextLabel.BorderColor3 = Color3.new(0, 0, 0)
TextLabel.BorderSizePixel = 0
TextLabel.Position = UDim2.new(0.156996593, 0, 0, 0)
TextLabel.Size = UDim2.new(0, 200, 0, 35)
TextLabel.Font = Enum.Font.SourceSansBold
TextLabel.Text = "Speed Tool"
TextLabel.TextColor3 = Color3.new(1, 1, 1)
TextLabel.TextScaled = true
TextLabel.TextSize = 14
TextLabel.TextWrapped = true

UICorner.Parent = Frame

SpeedInput.Name = "SpeedInput" -- Zmieniona nazwa obiektu
SpeedInput.Parent = Frame
SpeedInput.BackgroundColor3 = Color3.new(1, 1, 1)
SpeedInput.BorderColor3 = Color3.new(0, 0, 0)
SpeedInput.BorderSizePixel = 0
SpeedInput.Position = UDim2.new(0.105802044, 0, 0.134110793, 0)
SpeedInput.Size = UDim2.new(0, 235, 0, 42)
SpeedInput.Font = Enum.Font.SourceSansBold
SpeedInput.Text = "Wpisz Prędkość..." -- Domyślny tekst
SpeedInput.TextColor3 = Color3.new(0, 0, 0)
SpeedInput.TextScaled = true
SpeedInput.TextSize = 14
SpeedInput.TextWrapped = true
SpeedInput.ClearTextOnFocus = false -- Zachowuje domyślne zachowanie z Twojego starego skryptu

UICorner_2.Parent = SpeedInput

Button.Name = "Button" -- Zmieniona nazwa obiektu
Button.Parent = Frame
Button.BackgroundColor3 = Color3.new(1, 1, 1)
Button.BorderColor3 = Color3.new(0, 0, 0)
Button.BorderSizePixel = 0
Button.Position = UDim2.new(0.0682593882, 0, 0.527696788, 0)
Button.Size = UDim2.new(0, 253, 0, 50)
Button.Font = Enum.Font.Unknown
Button.Text = "Ustaw Prędkość"
Button.TextColor3 = Color3.new(0, 0, 0)
Button.TextScaled = true
Button.TextSize = 14
Button.TextWrapped = true

UICorner_3.Parent = Button

SaveSpeedButton.Name = "SaveSpeedButton" -- Zmieniona nazwa obiektu
SaveSpeedButton.Parent = Frame
SaveSpeedButton.BackgroundColor3 = Color3.new(1, 1, 1)
SaveSpeedButton.BorderColor3 = Color3.new(0, 0, 0)
SaveSpeedButton.BorderSizePixel = 0
SaveSpeedButton.Position = UDim2.new(0.075085327, 0, 0.725947499, 0)
SaveSpeedButton.Size = UDim2.new(0, 253, 0, 50)
SaveSpeedButton.Font = Enum.Font.Unknown
SaveSpeedButton.Text = "Zapisz Prędkość"
SaveSpeedButton.TextColor3 = Color3.new(0, 0, 0)
SaveSpeedButton.TextScaled = true
SaveSpeedButton.TextSize = 14
SaveSpeedButton.TextWrapped = true

UICorner_4.Parent = SaveSpeedButton

UIAspectRatioConstraint.Parent = ScreenGui
UIAspectRatioConstraint.AspectRatio = 1.9240963459014893

---
## Logika funkcjonalna (niezmieniona, ale od teraz połączona z nowym GUI)
---

-- Zmienna do zapisanej prędkości
local savedSpeed = nil

-- Obsługa kliknięć przycisków
Button.MouseButton1Click:Connect(function()
    local newSpeed = tonumber(SpeedInput.Text)
    if newSpeed then
        humanoid.WalkSpeed = newSpeed
        print("Prędkość ustawiona na: " .. newSpeed)
    else
        SpeedInput.Text = "Nieprawidłowa wartość"
    end
end)

SaveSpeedButton.MouseButton1Click:Connect(function()
    local newSpeed = tonumber(SpeedInput.Text)
    if newSpeed then
        savedSpeed = newSpeed
        SpeedInput.Text = "Zapisano: " .. savedSpeed -- Wyświetlanie zapisanej prędkości w polu tekstowym
        print("Prędkość zapisana: " .. savedSpeed)
    else
        SpeedInput.Text = "Nieprawidłowa wartość"
    end
end)

---
## Logika przeciągania GUI (obsługa myszy i dotyku)
---

local dragging = false
local dragInput, dragStart, startPos

Frame.InputBegan:Connect(function(input)
    -- Rozpoczyna przeciąganie przy kliknięciu myszy (MouseButton1) lub dotyku (Touch)
    if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
        dragging = true
        dragStart = input.Position
        startPos = Frame.Position
    end
end)

Frame.InputEnded:Connect(function(input)
    -- Kończy przeciąganie po zwolnieniu myszy lub oderwaniu palca
    if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
        dragging = false
    end
end)

Frame.InputChanged:Connect(function(input)
    -- Przesuwa ramkę podczas przeciągania
    if dragging and (input.UserInputType == Enum.UserInputType.MouseMovement or input.UserInputType == Enum.UserInputType.Touch) then
        local delta = input.Position - dragStart
        Frame.Position = UDim2.new(startPos.X.Scale, startPos.X.Offset + delta.X, startPos.Y.Scale, startPos.Y.Offset + delta.Y)
    end
end)

---
## Logika Toola (aktywacja, wyposażanie, odłożenie)
---

-- Zmienna do przechowywania poprzedniej prędkości
local previousSpeed = humanoid.WalkSpeed

-- Dodanie Toola do plecaka gracza
local tool = Instance.new("Tool")
tool.Name = "SpeedTool"
tool.RequiresHandle = false
tool.Parent = player.Backpack

tool.Activated:Connect(function()
    -- Zmiana prędkości po aktywacji narzędzia (kliknięciu)
    if savedSpeed then
        humanoid.WalkSpeed = savedSpeed  -- Ustawiamy zapisaną prędkość
        SpeedInput.Text = tostring(savedSpeed)  -- Wyświetlamy zapisaną prędkość w polu tekstowym
        print("Aktywowano Tool. Prędkość ustawiona na zapisaną: " .. savedSpeed)
    else
        humanoid.WalkSpeed = 16 -- Domyślna prędkość, jeśli nic nie zapisano
        SpeedInput.Text = "16"
        print("Aktywowano Tool. Nie ma zapisanej prędkości, ustawiono na 16.")
    end
    Frame.Visible = true  -- Wyświetlenie GUI po aktywacji narzędzia
end)

tool.Equipped:Connect(function()
    -- Gdy narzędzie jest w ręce, GUI staje się widoczne
    Frame.Visible = true
    SpeedInput.Text = tostring(savedSpeed or humanoid.WalkSpeed)  -- Pokazujemy zapisaną prędkość lub domyślną
    previousSpeed = humanoid.WalkSpeed -- Zapisz obecną prędkość przed jej zmianą, gdy narzędzie jest wyposażone
    print("Tool wyposażony. GUI widoczne.")
end)

tool.Unequipped:Connect(function()
    -- Gdy narzędzie jest odłożone, GUI znika i wracamy do poprzedniej prędkości
    Frame.Visible = false
    humanoid.WalkSpeed = previousSpeed  -- Przywracamy poprzednią prędkość po odłożeniu narzędzia
    SpeedInput.Text = tostring(previousSpeed)  -- Ustawiamy tekst w GUI na poprzednią wartość prędkości
    print("Tool odłożony. GUI ukryte, prędkość przywrócona do: " .. previousSpeed)
end)

print("Skrypt SpeedTool załadowany i gotowy do użycia.")
