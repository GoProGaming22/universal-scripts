--[[

        Gui2Lua™
        10zOfficial
        Version 1.0.0

]]

-- Instances

local ScreenGui = Instance.new("ScreenGui")
local Frame = Instance.new("Frame")
local TextLabel = Instance.new("TextLabel")
local UICorner = Instance.new("UICorner")
local Prdko = Instance.new("TextBox")
local UICorner_2 = Instance.new("UICorner")
local UstawPrdkoButton = Instance.new("TextButton")
local UICorner_3 = Instance.new("UICorner")
local ZapiszPrdkoButton = Instance.new("TextButton")
local UICorner_4 = Instance.new("UICorner")
local UIAspectRatioConstraint = Instance.new("UIAspectRatioConstraint")

-- Properties

ScreenGui.Parent = game.Players.LocalPlayer:WaitForChild("PlayerGui")
ScreenGui.ZIndexBehavior = Enum.ZIndexBehavior.Sibling
ScreenGui.ResetOnSpawn = false

Frame.Parent = ScreenGui
Frame.BackgroundColor3 = Color3.new(0.356863, 0.356863, 0.356863)
Frame.BackgroundTransparency = 0.30000001192092896
Frame.BorderColor3 = Color3.new(0, 0, 0)
Frame.BorderSizePixel = 5
Frame.Position = UDim2.new(0.784961402, 0, 0.430471897, 0)
Frame.Size = UDim2.new(0, 293, 0, 343)
Frame.Active = true
Frame.Draggable = false
Frame.Visible = false

TextLabel.Parent = Frame
TextLabel.BackgroundColor3 = Color3.new(1, 1, 1)
TextLabel.BackgroundTransparency = 1
TextLabel.BorderColor3 = Color3.new(0, 0, 0)
TextLabel.BorderSizePixel = 0
TextLabel.Position = UDim2.new(0.156996593, 0, 0, 0)
TextLabel.Size = UDim2.new(0, 200, 0, 35)
TextLabel.Font = Enum.Font.SourceSansBold
TextLabel.Text = "Speed Tool"
TextLabel.TextColor3 = Color3.new(1, 1, 1)
TextLabel.TextScaled = true
TextLabel.TextSize = 14
TextLabel.TextWrapped = true

UICorner.Parent = Frame

Prdko.Name = "Prędkość"
Prdko.Parent = Frame
Prdko.BackgroundColor3 = Color3.new(1, 1, 1)
Prdko.BorderColor3 = Color3.new(0, 0, 0)
Prdko.BorderSizePixel = 0
Prdko.Position = UDim2.new(0.105802044, 0, 0.134110793, 0)
Prdko.Size = UDim2.new(0, 235, 0, 42)
Prdko.Font = Enum.Font.SourceSansBold
Prdko.Text = "Wpisz Prędkość..."
Prdko.TextColor3 = Color3.new(0, 0, 0)
Prdko.TextScaled = true
Prdko.TextSize = 14
Prdko.TextWrapped = true

UICorner_2.Parent = Prdko

UstawPrdkoButton.Name = "UstawPrędkośćButton"
UstawPrdkoButton.Parent = Frame
UstawPrdkoButton.BackgroundColor3 = Color3.new(1, 1, 1)
UstawPrdkoButton.BorderColor3 = Color3.new(0, 0, 0)
UstawPrdkoButton.BorderSizePixel = 0
UstawPrdkoButton.Position = UDim2.new(0.0682593882, 0, 0.527696788, 0)
UstawPrdkoButton.Size = UDim2.new(0, 253, 0, 50)
UstawPrdkoButton.Font = Enum.Font.Unknown
UstawPrdkoButton.Text = "Ustaw Prędkość"
UstawPrdkoButton.TextColor3 = Color3.new(0, 0, 0)
UstawPrdkoButton.TextScaled = true
UstawPrdkoButton.TextSize = 14
TextButton_ToggleTP.TextWrapped = true

UICorner_3.Parent = UstawPrdkoButton

ZapiszPrdkoButton.Name = "ZapiszPrędkośćButton"
ZapiszPrdkoButton.Parent = Frame
ZapiszPrdkoButton.BackgroundColor3 = Color3.new(1, 1, 1)
ZapiszPrdkoButton.BorderColor3 = Color3.new(0, 0, 0)
ZapiszPrdkoButton.BorderSizePixel = 0
ZapiszPrdkoButton.Position = UDim2.new(0.075085327, 0, 0.725947499, 0)
ZapiszPrdkoButton.Size = UDim2.new(0, 253, 0, 50)
ZapiszPrdkoButton.Font = Enum.Font.Unknown
ZapiszPrdkoButton.Text = "Zapisz Prędkość"
ZapiszPrdkoButton.TextColor3 = Color3.new(0, 0, 0)
ZapiszPrdkoButton.TextScaled = true
ZapiszPrdkoButton.TextSize = 14
ZapiszPrdkoButton.TextWrapped = true

UICorner_4.Parent = ZapiszPrdkoButton

UIAspectRatioConstraint.Parent = ScreenGui
UIAspectRatioConstraint.AspectRatio = 1.9240963459014893

-- Scripts

local player = game.Players.LocalPlayer
local UserInputService = game:GetService("UserInputService")
local DataStoreService = game:GetService("DataStoreService")
local speedDataStore = DataStoreService:GetDataStore("PlayerSpeed")

local humanoid = nil -- Będzie ustawiane dynamicznie po załadowaniu postaci

local function sendNotification(title, text)
    game.StarterGui:SetCore("SendNotification", {
        Title = title,
        Text = text,
        Icon = "rbxassetid://6022295536",
        Duration = 5
    })
end

local function makeDraggable(frame)
    local dragging = false
    local dragStart = Vector2.new(0,0)
    local startPosition = UDim2.new(0,0,0,0)

    frame.InputBegan:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
            dragging = true
            dragStart = input.Position
            startPosition = frame.Position
            input.Changed:Connect(function()
                if input.UserInputState == Enum.UserInputState.Ended then
                    dragging = false
                end
            end)
        end
    end)

    UserInputService.InputChanged:Connect(function(input, gameProcessedEvent)
        if input.UserInputType == Enum.UserInputType.MouseMovement or input.UserInputType == Enum.UserInputType.Touch then
            if dragging and not gameProcessedEvent then
                local delta = input.Position - dragStart
                frame.Position = UDim2.new(startPosition.X.Scale, startPosition.X.Offset + delta.X, startPosition.Y.Scale, startPosition.Y.Offset + delta.Y)
            end
        end
    end)

    UserInputService.InputEnded:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
            dragging = false
        end
    end)
end

makeDraggable(Frame)

UstawPrdkoButton.Activated:Connect(function()
    local newSpeed = tonumber(Prdko.Text)
    if newSpeed and humanoid then
        humanoid.WalkSpeed = newSpeed
        sendNotification("Speed Tool", "Prędkość ustawiona na: " .. newSpeed)
    else
        sendNotification("Speed Tool", "Nieprawidłowa wartość prędkości!")
    end
end)

ZapiszPrdkoButton.Activated:Connect(function()
    local speedToSave = tonumber(Prdko.Text)
    if speedToSave then
        pcall(function()
            speedDataStore:SetAsync(player.UserId, speedToSave)
            sendNotification("Speed Tool", "Prędkość zapisana: " .. speedToSave)
        end)
    else
        sendNotification("Speed Tool", "Wpisz prawidłową prędkość do zapisania.")
    end
end)

-- Stworzenie tool'a
local tool = Instance.new("Tool")
tool.Name = "SpeedTool"
tool.RequiresHandle = false
tool.CanBeDropped = false -- Nie można go upuścić
tool.Parent = player.StarterGear -- Dodaje do ekwipunku startowego gracza

-- Obsługa tool'a
tool.Activated:Connect(function()
    Frame.Visible = not Frame.Visible -- Przełącz widoczność GUI
    if Frame.Visible then
        -- Jeśli GUI się otwiera, zaktualizuj pole tekstowe bieżącą prędkością lub zapisaną
        if humanoid then
            local loadedSpeed = pcall(function()
                return speedDataStore:GetAsync(player.UserId)
            end)
            if loadedSpeed[1] and loadedSpeed[2] ~= nil then
                Prdko.Text = tostring(loadedSpeed[2])
            else
                Prdko.Text = tostring(humanoid.WalkSpeed) -- Ustaw bieżącą prędkość, jeśli brak zapisanej
            end
        end
    end
end)

tool.Equipped:Connect(function()
    Frame.Visible = true
    if humanoid then
        local loadedSpeed = pcall(function()
            return speedDataStore:GetAsync(player.UserId)
        end)
        if loadedSpeed[1] and loadedSpeed[2] ~= nil then
            Prdko.Text = tostring(loadedSpeed[2])
        else
            Prdko.Text = tostring(humanoid.WalkSpeed)
        end
    end
end)

tool.Unequipped:Connect(function()
    Frame.Visible = false
    -- Prędkość gracza pozostaje bez zmian
end)

-- Wczytaj zapisaną prędkość i ustaw ją po załadowaniu postaci gracza
player.CharacterAdded:Connect(function(char)
    humanoid = char:WaitForChild("Humanoid")
    spawn(function()
        local loadedSpeed = pcall(function()
            return speedDataStore:GetAsync(player.UserId)
        end)
        if loadedSpeed[1] and loadedSpeed[2] ~= nil then
            humanoid.WalkSpeed = loadedSpeed[2]
            sendNotification("Speed Tool", "Wczytano i ustawiono zapisaną prędkość: " .. loadedSpeed[2])
        end
    end)
end)
