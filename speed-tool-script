-- Ustawienia początkowe skryptu
local player = game.Players.LocalPlayer
local character = player.Character or player.CharacterAdded:Wait()
local humanoid = character:WaitForChild("Humanoid")

-- Zmienne globalne dla funkcjonalności prędkości
local savedSpeed = nil
local previousSpeed = humanoid.WalkSpeed

-- Pobranie serwisów Roblox, które będą potrzebne
local UserInputService = game:GetService("UserInputService") -- Potrzebne do obsługi myszy i dotyku
local Players = game:GetService("Players")

--- KOD Z NOWEGO GUI ---
-- Tworzenie instancji wszystkich elementów GUI
local ScreenGui = Instance.new("ScreenGui")
local Frame = Instance.new("Frame")
local TextLabel = Instance.new("TextLabel")
local UICorner = Instance.new("UICorner")
local Prdko = Instance.new("TextBox") -- Pole do wpisywania prędkości
local UICorner_2 = Instance.new("UICorner")
local UstawPrdkoButton = Instance.new("TextButton") -- Przycisk "Ustaw Prędkość"
local UICorner_3 = Instance.new("UICorner")
local ZapiszPrdkoButton = Instance.new("TextButton") -- Przycisk "Zapisz Prędkość"
local UICorner_4 = Instance.new("UICorner")
local UIAspectRatioConstraint = Instance.new("UIAspectRatioConstraint")

-- Ustawianie właściwości dla ScreenGui
ScreenGui.Parent = player:WaitForChild("PlayerGui") -- Upewniamy się, że ScreenGui jest w PlayerGui
ScreenGui.ZIndexBehavior = Enum.ZIndexBehavior.Sibling

-- Ustawianie właściwości dla głównej ramki (Frame)
Frame.Parent = ScreenGui
Frame.BackgroundColor3 = Color3.new(0.356863, 0.356863, 0.356863)
Frame.BackgroundTransparency = 0.30000001192092896
Frame.BorderColor3 = Color3.new(0, 0, 0)
Frame.BorderSizePixel = 5
Frame.Position = UDim2.new(0.784961402, 0, 0.430471897, 0)
Frame.Size = UDim2.new(0, 293, 0, 343)
Frame.Active = true -- !!! TO JEST KLUCZOWE DLA DZIAŁANIA PRZECIĄGANIA DOTYKIEM !!!
Frame.Selectable = false -- Upewniamy się, że ramka nie jest wybieralna

-- Ustawianie właściwości dla etykiety tekstowej (TextLabel)
TextLabel.Parent = Frame
TextLabel.BackgroundColor3 = Color3.new(1, 1, 1)
TextLabel.BackgroundTransparency = 1
TextLabel.BorderColor3 = Color3.new(0, 0, 0)
TextLabel.BorderSizePixel = 0
TextLabel.Position = UDim2.new(0.156996593, 0, 0, 0)
TextLabel.Size = UDim2.new(0, 200, 0, 35)
TextLabel.Font = Enum.Font.SourceSansBold
TextLabel.Text = "Speed Tool"
TextLabel.TextColor3 = Color3.new(1, 1, 1)
TextLabel.TextScaled = true
TextLabel.TextSize = 14
TextLabel.TextWrapped = true

-- Ustawianie właściwości dla zaokrąglenia ramki
UICorner.Parent = Frame

-- Ustawianie właściwości dla pola tekstowego (Prdko - prędkość)
Prdko.Name = "Prędkość"
Prdko.Parent = Frame
Prdko.BackgroundColor3 = Color3.new(1, 1, 1)
Prdko.BorderColor3 = Color3.new(0, 0, 0)
Prdko.BorderSizePixel = 0
Prdko.Position = UDim2.new(0.105802044, 0, 0.134110793, 0)
Prdko.Size = UDim2.new(0, 235, 0, 42)
Prdko.Font = Enum.Font.SourceSansBold
Prdko.Text = "Wpisz Prędkość..."
Prdko.TextColor3 = Color3.new(0, 0, 0)
Prdko.TextScaled = true
Prdko.TextSize = 14
Prdko.TextWrapped = true

-- Ustawianie właściwości dla zaokrąglenia pola tekstowego
UICorner_2.Parent = Prdko

-- Ustawianie właściwości dla przycisku "Ustaw Prędkość" (UstawPrdkoButton)
UstawPrdkoButton.Name = "UstawPrędkośćButton"
UstawPrdkoButton.Parent = Frame
UstawPrdkoButton.BackgroundColor3 = Color3.new(1, 1, 1)
UstawPrdkoButton.BorderColor3 = Color3.new(0, 0, 0)
UstawPrdkoButton.BorderSizePixel = 0
UstawPrdkoButton.Position = UDim2.new(0.0682593882, 0, 0.527696788, 0)
UstawPrdkoButton.Size = UDim2.new(0, 253, 0, 50)
UstawPrdkoButton.Font = Enum.Font.Unknown
UstawPrdkoButton.Text = "Ustaw Prędkość"
UstawPrdkoButton.TextColor3 = Color3.new(0, 0, 0)
UstawPrdkoButton.TextScaled = true
UstawPrdkoButton.TextSize = 14
UstawPrdkoButton.TextWrapped = true

-- Ustawianie właściwości dla zaokrąglenia przycisku "Ustaw Prędkość"
UICorner_3.Parent = UstawPrdkoButton

-- Ustawianie właściwości dla przycisku "Zapisz Prędkość" (ZapiszPrdkoButton)
ZapiszPrdkoButton.Name = "ZapiszPrędkośćButton"
ZapiszPrdkoButton.Parent = Frame
ZapiszPrdkoButton.BackgroundColor3 = Color3.new(1, 1, 1)
ZapiszPrdkoButton.BorderColor3 = Color3.new(0, 0, 0)
ZapiszPrdkoButton.BorderSizePixel = 0
ZapiszPrdkoButton.Position = UDim2.new(0.075085327, 0, 0.725947499, 0)
ZapiszPrdkoButton.Size = UDim2.new(0, 253, 0, 50)
ZapiszPrdkoButton.Font = Enum.Font.Unknown
ZapiszPrdkoButton.Text = "Zapisz Prędkość"
ZapiszPrdkoButton.TextColor3 = Color3.new(0, 0, 0)
ZapiszPrdkoButton.TextScaled = true
ZapiszPrdkoButton.TextSize = 14
ZapiszPrdkoButton.TextWrapped = true

-- Ustawianie właściwości dla zaokrąglenia przycisku "Zapisz Prędkość"
UICorner_4.Parent = ZapiszPrdkoButton

-- Ustawianie właściwości dla aspekt ratio GUI
UIAspectRatioConstraint.Parent = ScreenGui
UIAspectRatioConstraint.AspectRatio = 1.9240963459014893

--- KONIEC KODU Z NOWEGO GUI ---

-- Funkcja do zmiany prędkości gracza, podłączona do przycisku UstawPrdkoButton
UstawPrdkoButton.MouseButton1Click:Connect(function()
    local newSpeed = tonumber(Prdko.Text) -- Pobieranie wartości z pola tekstowego
    if newSpeed and newSpeed > 0 then -- Sprawdzenie, czy to prawidłowa liczba i większa od 0
        humanoid.WalkSpeed = newSpeed
        Prdko.Text = "Ustawiono: " .. newSpeed -- Informacja zwrotna w polu
    else
        Prdko.Text = "Nieprawidłowa wartość!" -- Komunikat o błędzie
    end
end)

-- Funkcja do zapisywania prędkości, podłączona do przycisku ZapiszPrdkoButton
ZapiszPrdkoButton.MouseButton1Click:Connect(function()
    local newSpeed = tonumber(Prdko.Text)
    if newSpeed and newSpeed > 0 then
        savedSpeed = newSpeed
        Prdko.Text = "Zapisano: " .. savedSpeed
    else
        Prdko.Text = "Nieprawidłowa wartość!"
    end
end)

--- FUNKCJA makeDraggable (przesuwanie GUI) ---
local function makeDraggable(frameToDrag)
    local dragging = false
    local dragStart = Vector2.new(0,0)
    local startPosition = UDim2.new(0,0,0,0)

    -- Rozpoczęcie przeciągania po naciśnięciu myszy lub dotknięciu
    frameToDrag.InputBegan:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
            dragging = true
            dragStart = input.Position
            startPosition = frameToDrag.Position
            -- Subskrybuj zdarzenie InputEnded dla tego konkretnego inputu,
            -- aby zakończyć przeciąganie, nawet jeśli użytkownik puści palec poza ramką.
            input.Changed:Connect(function()
                if input.UserInputState == Enum.UserInputState.Ended then
                    dragging = false
                end
            end)
        end
    end)

    -- Śledzenie ruchu myszy lub dotyku podczas przeciągania
    UserInputService.InputChanged:Connect(function(input, gameProcessedEvent)
        if input.UserInputType == Enum.UserInputType.MouseMovement or input.UserInputType == Enum.UserInputType.Touch then
            if dragging and not gameProcessedEvent then -- Sprawdź, czy przeciągamy i czy gra nie przetworzyła już zdarzenia
                local delta = input.Position - dragStart
                frameToDrag.Position = UDim2.new(startPosition.X.Scale, startPosition.X.Offset + delta.X, startPosition.Y.Scale, startPosition.Y.Offset + delta.Y)
            end
        end
    end)

    -- Zakończenie przeciągania, gdy mysz lub dotyk przestaje być aktywny
    -- (dodatkowe zabezpieczenie, jeśli InputEnded z `input.Changed` nie zadziała)
    UserInputService.InputEnded:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
            dragging = false
        end
    end)
end

-- Aktywacja funkcji makeDraggable dla Twojej głównej ramki GUI
makeDraggable(Frame)

--- DODANIE I OBSŁUGA NARZĘDZIA (TOOL) ---
local tool = Instance.new("Tool")
tool.Name = "SpeedTool"
tool.RequiresHandle = false
tool.Parent = player.Backpack

-- Funkcja wywoływana po aktywacji narzędzia (np. kliknięcie, dotknięcie)
tool.Activated:Connect(function()
    if savedSpeed then -- Jeśli jest zapisana prędkość, ustaw ją
        humanoid.WalkSpeed = savedSpeed
        Prdko.Text = tostring(savedSpeed)
    else
        Prdko.Text = "Wpisz Prędkość..." -- W przeciwnym razie, ustaw domyślny tekst
    end
    ScreenGui.Enabled = true -- Pokaż całe GUI
    Frame.Visible = true -- Upewnij się, że ramka też jest widoczna
end)

-- Funkcja wywoływana, gdy narzędzie jest trzymane w ręce
tool.Equipped:Connect(function()
    ScreenGui.Enabled = true -- Pokaż GUI
    Frame.Visible = true
    Prdko.Text = tostring(savedSpeed or humanoid.WalkSpeed) -- Pokaż zapisaną lub aktualną prędkość
end)

-- Funkcja wywoływana, gdy narzędzie jest odłożone
tool.Unequipped:Connect(function()
    ScreenGui.Enabled = false -- Ukryj całe GUI
    Frame.Visible = false
    humanoid.WalkSpeed = previousSpeed -- Przywróć poprzednią prędkość
    Prdko.Text = tostring(previousSpeed) -- Ustaw tekst w polu na poprzednią prędkość
end)
