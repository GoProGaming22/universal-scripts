-- Ustawienia początkowe
local gracz = game.Players.LocalPlayer
local postac = gracz.Character or gracz.CharacterAdded:Wait()
local humanoid = postac:WaitForChild("Humanoid")
local UsrInputSrv = game:GetService("UserInputService") -- Usługa do obsługi wejścia użytkownika (mysz, dotyk)

---
## Nowe GUI (z obsługą przeciągania myszą i dotykiem)
---

local GlownyEkranGUI = Instance.new("ScreenGui")
local Ramka = Instance.new("Frame")
local EtykietaTekstowa = Instance.new("TextLabel")
local ZaokraglenieRogow = Instance.new("UICorner")
local PoleWpisywaniaPredkosci = Instance.new("TextBox") -- Zmieniona nazwa zmiennej
local ZaokraglenieRogow2 = Instance.new("UICorner")
local PrzyciskUstawPredkosc = Instance.new("TextButton") -- Zmieniona nazwa zmiennej
local ZaokraglenieRogow3 = Instance.new("UICorner")
local PrzyciskZapiszPredkosc = Instance.new("TextButton") -- Zmieniona nazwa zmiennej
local ZaokraglenieRogow4 = Instance.new("UICorner")
local OgraniczenieProporcjiUI = Instance.new("UIAspectRatioConstraint")

-- Właściwości i hierarchia GUI
GlownyEkranGUI.Parent = gracz:WaitForChild("PlayerGui")
GlownyEkranGUI.ZIndexBehavior = Enum.ZIndexBehavior.Sibling

Ramka.Parent = GlownyEkranGUI
Ramka.BackgroundColor3 = Color3.new(0.356863, 0.356863, 0.356863)
Ramka.BackgroundTransparency = 0.30000001192092896
Ramka.BorderColor3 = Color3.new(0, 0, 0)
Ramka.BorderSizePixel = 5
Ramka.Position = UDim2.new(0.784961402, 0, 0.430471897, 0)
Ramka.Size = UDim2.new(0, 293, 0, 343)
Ramka.Active = true -- Kluczowe: Umożliwia ramce reagowanie na input (przeciąganie myszą i dotykiem)

EtykietaTekstowa.Parent = Ramka
EtykietaTekstowa.BackgroundColor3 = Color3.new(1, 1, 1)
EtykietaTekstowa.BackgroundTransparency = 1
EtykietaTekstowa.BorderColor3 = Color3.new(0, 0, 0)
EtykietaTekstowa.BorderSizePixel = 0
EtykietaTekstowa.Position = UDim2.new(0.156996593, 0, 0, 0)
EtykietaTekstowa.Size = UDim2.new(0, 200, 0, 35)
EtykietaTekstowa.Font = Enum.Font.SourceSansBold
EtykietaTekstowa.Text = "Narzędzie Prędkości"
EtykietaTekstowa.TextColor3 = Color3.new(1, 1, 1)
EtykietaTekstowa.TextScaled = true
EtykietaTekstowa.TextSize = 14
EtykietaTekstowa.TextWrapped = true

ZaokraglenieRogow.Parent = Ramka

PoleWpisywaniaPredkosci.Name = "SpeedInput" -- Zachowana oryginalna nazwa obiektu dla kompatybilności z logiką
PoleWpisywaniaPredkosci.Parent = Ramka
PoleWpisywaniaPredkosci.BackgroundColor3 = Color3.new(1, 1, 1)
PoleWpisywaniaPredkosci.BorderColor3 = Color3.new(0, 0, 0)
PoleWpisywaniaPredkosci.BorderSizePixel = 0
PoleWpisywaniaPredkosci.Position = UDim2.new(0.105802044, 0, 0.134110793, 0)
PoleWpisywaniaPredkosci.Size = UDim2.new(0, 235, 0, 42)
PoleWpisywaniaPredkosci.Font = Enum.Font.SourceSansBold
PoleWpisywaniaPredkosci.Text = "Wpisz Prędkość..." -- Domyślny tekst
PoleWpisywaniaPredkosci.TextColor3 = Color3.new(0, 0, 0)
PoleWpisywaniaPredkosci.TextScaled = true
PoleWpisywaniaPredkosci.TextSize = 14
PoleWpisywaniaPredkosci.TextWrapped = true
PoleWpisywaniaPredkosci.ClearTextOnFocus = false -- Zachowuje domyślne zachowanie

ZaokraglenieRogow2.Parent = PoleWpisywaniaPredkosci

PrzyciskUstawPredkosc.Name = "Button" -- Zachowana oryginalna nazwa obiektu dla kompatybilności z logiką
PrzyciskUstawPredkosc.Parent = Ramka
PrzyciskUstawPredkosc.BackgroundColor3 = Color3.new(1, 1, 1)
PrzyciskUstawPredkosc.BorderColor3 = Color3.new(0, 0, 0)
PrzyciskUstawPredkosc.BorderSizePixel = 0
PrzyciskUstawPredkosc.Position = UDim2.new(0.0682593882, 0, 0.527696788, 0)
PrzyciskUstawPredkosc.Size = UDim2.new(0, 253, 0, 50)
PrzyciskUstawPredkosc.Font = Enum.Font.Unknown
PrzyciskUstawPredkosc.Text = "Ustaw Prędkość"
PrzyciskUstawPredkosc.TextColor3 = Color3.new(0, 0, 0)
PrzyciskUstawPredkosc.TextScaled = true
PrzyciskUstawPredkosc.TextSize = 14
PrzyciskUstawPredkosc.TextWrapped = true

ZaokraglenieRogow3.Parent = PrzyciskUstawPredkosc

PrzyciskZapiszPredkosc.Name = "SaveSpeedButton" -- Zachowana oryginalna nazwa obiektu dla kompatybilności z logiką
PrzyciskZapiszPredkosc.Parent = Ramka
PrzyciskZapiszPredkosc.BackgroundColor3 = Color3.new(1, 1, 1)
PrzyciskZapiszPredkosc.BorderColor3 = Color3.new(0, 0, 0)
PrzyciskZapiszPredkosc.BorderSizePixel = 0
PrzyciskZapiszPredkosc.Position = UDim2.new(0.075085327, 0, 0.725947499, 0)
PrzyciskZapiszPredkosc.Size = UDim2.new(0, 253, 0, 50)
PrzyciskZapiszPredkosc.Font = Enum.Font.Unknown
PrzyciskZapiszPredkosc.Text = "Zapisz Prędkość"
PrzyciskZapiszPredkosc.TextColor3 = Color3.new(0, 0, 0)
PrzyciskZapiszPredkosc.TextScaled = true
PrzyciskZapiszPredkosc.TextSize = 14
PrzyciskZapiszPredkosc.TextWrapped = true

ZaokraglenieRogow4.Parent = PrzyciskZapiszPredkosc

OgraniczenieProporcjiUI.Parent = GlownyEkranGUI
OgraniczenieProporcjiUI.AspectRatio = 1.9240963459014893

---
## Logika funkcjonalna (z pierwszego skryptu)
---

-- Zmienna do zapisanej prędkości
local zapisanaPredkosc = nil

-- Obsługa kliknięć przycisków
PrzyciskUstawPredkosc.MouseButton1Click:Connect(function()
    local nowaPredkosc = tonumber(PoleWpisywaniaPredkosci.Text)
    if nowaPredkosc then
        humanoid.WalkSpeed = nowaPredkosc
        print("Prędkość ustawiona na: " .. nowaPredkosc)
    else
        PoleWpisywaniaPredkosci.Text = "Nieprawidłowa wartość"
    end
end)

PrzyciskZapiszPredkosc.MouseButton1Click:Connect(function()
    local nowaPredkosc = tonumber(PoleWpisywaniaPredkosci.Text)
    if nowaPredkosc then
        zapisanaPredkosc = nowaPredkosc
        PoleWpisywaniaPredkosci.Text = "Zapisano: " .. zapisanaPredkosc
        print("Prędkość zapisana: " .. zapisanaPredkosc)
    else
        PoleWpisywaniaPredkosci.Text = "Nieprawidłowa wartość"
    end
end)

---
## Funkcja do przeciągania GUI (obsługa myszy i dotyku)
---

local function makeDraggable(frame)
    local dragging = false
    local dragStart = Vector2.new(0,0)
    local startPosition = UDim2.new(0,0,0,0)

    frame.InputBegan:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
            dragging = true
            dragStart = input.Position
            startPosition = frame.Position
            -- W starszych wersjach Roblox, Input.Changed był potrzebny do wykrywania końca przeciągania,
            -- ale InputEnded na UserInputService jest teraz bardziej niezawodne.
            -- Zostawiam InputEnded poniżej.
        end
    end)

    -- Ta funkcja InputChanged powinna być podłączona do UserInputService,
    -- aby działać również wtedy, gdy mysz/palec opuści ramkę GUI.
    UsrInputSrv.InputChanged:Connect(function(input, gameProcessedEvent)
        if input.UserInputType == Enum.UserInputType.MouseMovement or input.UserInputType == Enum.UserInputType.Touch then
            if dragging and not gameProcessedEvent then -- Sprawdzamy gameProcessedEvent, by unikać konfliktu z innymi elementami GUI
                local delta = input.Position - dragStart
                frame.Position = UDim2.new(startPosition.X.Scale, startPosition.X.Offset + delta.X, startPosition.Y.Scale, startPosition.Y.Offset + delta.Y)
            end
        end
    end)

    -- Używamy InputEnded z UserInputService dla pewniejszego wykrycia końca przeciągania
    UsrInputSrv.InputEnded:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
            dragging = false
        end
    end)
end

-- Wywołanie funkcji, aby nasza Ramka była przeciągalna
makeDraggable(Ramka)

---
## Logika Narzędzia (Toola)
---

-- Zmienna do przechowywania poprzedniej prędkości
local poprzedniaPredkosc = humanoid.WalkSpeed

-- Dodanie Narzędzia do plecaka gracza
local narzedzie = Instance.new("Tool")
narzedzie.Name = "NarzędziePrędkości" -- Nazwa narzędzia
narzedzie.RequiresHandle = false
narzedzie.Parent = gracz.Backpack

narzedzie.Activated:Connect(function()
    -- Zmiana prędkości po aktywacji narzędzia (kliknięciu)
    if zapisanaPredkosc then
        humanoid.WalkSpeed = zapisanaPredkosc  -- Ustawiamy zapisaną prędkość
        PoleWpisywaniaPredkosci.Text = tostring(zapisanaPredkosc)  -- Wyświetlamy zapisaną prędkość w polu tekstowym
        print("Narzędzie aktywowane. Prędkość ustawiona na zapisaną: " .. zapisanaPredkosc)
    else
        humanoid.WalkSpeed = 16 -- Domyślna prędkość, jeśli nic nie zapisano
        PoleWpisywaniaPredkosci.Text = "16"
        print("Narzędzie aktywowane. Nie ma zapisanej prędkości, ustawiono na 16.")
    end
    Ramka.Visible = true  -- Wyświetlenie GUI po aktywacji narzędzia
end)

narzedzie.Equipped:Connect(function()
    -- Gdy narzędzie jest w ręce, GUI staje się widoczne
    Ramka.Visible = true
    PoleWpisywaniaPredkosci.Text = tostring(zapisanaPredkosc or humanoid.WalkSpeed)  -- Pokazujemy zapisaną prędkość lub domyślną
    poprzedniaPredkosc = humanoid.WalkSpeed -- Zapisz obecną prędkość przed jej zmianą, gdy narzędzie jest wyposażone
    print("Narzędzie wyposażone. GUI widoczne.")
end)

narzedzie.Unequipped:Connect(function()
    -- Gdy narzędzie jest odłożone, GUI znika i wracamy do poprzedniej prędkości
    Ramka.Visible = false
    humanoid.WalkSpeed = poprzedniaPredkosc  -- Przywracamy poprzednią prędkość po odłożeniu narzędzia
    PoleWpisywaniaPredkosci.Text = tostring(poprzedniaPredkosc)  -- Ustawiamy tekst w GUI na poprzednią wartość prędkości
    print("Narzędzie odłożone. GUI ukryte, prędkość przywrócona do: " .. poprzedniaPredkosc)
end)

print("Skrypt Narzędzia Prędkości załadowany i gotowy do użycia.")
