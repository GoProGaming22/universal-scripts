-- Konfiguracja początkowa skryptu
local player = game.Players.LocalPlayer
local character = player.Character or player.CharacterAdded:Wait()
local humanoid = character:WaitForChild("Humanoid")

-- Pobieranie serwisów Roblox
local UserInputService = game:GetService("UserInputService") -- Potrzebne do obsługi myszy i dotyku

-- Zmienne globalne dla funkcjonalności prędkości
local savedSpeed = nil
local previousSpeed = humanoid.WalkSpeed

--- Tworzenie GUI ---
-- Tworzenie instancji wszystkich elementów GUI
local ScreenGui = Instance.new("ScreenGui")
local Frame = Instance.new("Frame")
local TextLabel = Instance.new("TextLabel")
local SpeedInput = Instance.new("TextBox") -- Pole tekstowe do wprowadzania prędkości
local Button = Instance.new("TextButton") -- Przycisk do zmiany prędkości
local SaveSpeedButton = Instance.new("TextButton") -- Przycisk do zapisywania prędkości

-- Ustawianie właściwości dla ScreenGui
ScreenGui.Parent = player:WaitForChild("PlayerGui")
ScreenGui.ZIndexBehavior = Enum.ZIndexBehavior.Sibling
-- ScreenGui.ResetOnSpawn = false -- Opcjonalnie: odkomentuj, jeśli GUI ma pozostać po śmierci gracza

-- Ustawianie właściwości dla głównej ramki (Frame)
Frame.Parent = ScreenGui
Frame.Size = UDim2.new(0, 250, 0, 200)
Frame.Position = UDim2.new(0.4, 0, 0.4, 0)
Frame.BackgroundColor3 = Color3.fromRGB(50, 50, 50)
Frame.BorderSizePixel = 2
Frame.Active = true -- !!! KLUCZOWE: Umożliwia ramce odbieranie zdarzeń dotyku i myszy do przeciągania !!!
Frame.Selectable = false -- Opcjonalnie: Zapobiega wybieraniu ramki, co może kolidować z przeciąganiem

-- Ustawianie właściwości dla etykiety tekstowej (TextLabel)
TextLabel.Parent = Frame
TextLabel.Size = UDim2.new(1, -10, 0, 30)
TextLabel.Position = UDim2.new(0, 5, 0, 5)
TextLabel.Text = "Ustaw prędkość"
TextLabel.TextScaled = true
TextLabel.TextColor3 = Color3.new(1, 1, 1)
TextLabel.BackgroundTransparency = 1

-- Ustawianie właściwości dla pola tekstowego (SpeedInput)
SpeedInput.Parent = Frame
SpeedInput.Size = UDim2.new(1, -10, 0, 40)
SpeedInput.Position = UDim2.new(0, 5, 0, 40)
SpeedInput.Text = "16" -- Domyślna prędkość
SpeedInput.BackgroundColor3 = Color3.fromRGB(70, 70, 70)
SpeedInput.TextColor3 = Color3.new(1, 1, 1)
SpeedInput.ClearTextOnFocus = false

-- Ustawianie właściwości dla przycisku zmiany prędkości (Button)
Button.Parent = Frame
Button.Size = UDim2.new(1, -10, 0, 40)
Button.Position = UDim2.new(0, 5, 0, 90)
Button.Text = "Zmień prędkość"
Button.BackgroundColor3 = Color3.fromRGB(30, 30, 30)
Button.TextColor3 = Color3.new(1, 1, 1)

-- Ustawianie właściwości dla przycisku zapisywania prędkości (SaveSpeedButton)
SaveSpeedButton.Parent = Frame
SaveSpeedButton.Size = UDim2.new(1, -10, 0, 40)
SaveSpeedButton.Position = UDim2.new(0, 5, 0, 140)
SaveSpeedButton.Text = "Zapisz prędkość"
SaveSpeedButton.BackgroundColor3 = Color3.fromRGB(30, 30, 30)
SaveSpeedButton.TextColor3 = Color3.new(1, 1, 1)

--- Koniec tworzenia GUI ---

-- Funkcja do zmiany prędkości gracza, podłączona do przycisku Button
Button.MouseButton1Click:Connect(function()
    local newSpeed = tonumber(SpeedInput.Text)
    if newSpeed and newSpeed > 0 then
        humanoid.WalkSpeed = newSpeed
        SpeedInput.Text = "Ustawiono: " .. newSpeed
    else
        SpeedInput.Text = "Nieprawidłowa wartość!"
    end
end)

-- Funkcja do zapisywania prędkości, podłączona do przycisku SaveSpeedButton
SaveSpeedButton.MouseButton1Click:Connect(function()
    local newSpeed = tonumber(SpeedInput.Text)
    if newSpeed and newSpeed > 0 then
        savedSpeed = newSpeed
        SpeedInput.Text = "Zapisano: " .. savedSpeed
    else
        SpeedInput.Text = "Nieprawidłowa wartość!"
    end
end)

--- FUNKCJA makeDraggable (przesuwanie GUI) ---
-- Ta funkcja sprawia, że podana ramka GUI staje się przeciągalna
local function makeDraggable(frameToDrag)
    local dragging = false
    local dragStart = Vector2.new(0,0)
    local startPosition = UDim2.new(0,0,0,0)

    -- Rozpoczęcie przeciągania po naciśnięciu myszy lub dotknięciu ramki
    frameToDrag.InputBegan:Connect(function(input)
        -- Sprawdzamy, czy input to mysz LUB dotyk, I czy nie dotykamy pola tekstowego
        if (input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch) and input.Target ~= SpeedInput then
            dragging = true
            dragStart = input.Position
            startPosition = frameToDrag.Position
            -- Podłączamy zdarzenie InputChanged do tego konkretnego inputu,
            -- aby śledzić ruch palca/myszy nawet poza ramką
            input.Changed:Connect(function()
                if input.UserInputState == Enum.UserInputState.Ended then
                    dragging = false
                end
            end)
        end
    end)

    -- Śledzenie ruchu myszy lub dotyku podczas przeciągania
    UserInputService.InputChanged:Connect(function(input, gameProcessedEvent)
        if input.UserInputType == Enum.UserInputType.MouseMovement or input.UserInputType == Enum.UserInputType.Touch then
            -- Sprawdzamy, czy przeciągamy i czy zdarzenie nie zostało już przetworzone przez grę (np. kamera)
            if dragging and not gameProcessedEvent then
                local delta = input.Position - dragStart
                frameToDrag.Position = UDim2.new(startPosition.X.Scale, startPosition.X.Offset + delta.X, startPosition.Y.Scale, startPosition.Y.Offset + delta.Y)
            end
        end
    end)

    -- Zakończenie przeciągania, gdy mysz lub dotyk przestaje być aktywny (dodatkowe zabezpieczenie)
    UserInputService.InputEnded:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
            dragging = false
        end
    end)
end

-- Aktywacja funkcji makeDraggable dla Twojej głównej ramki GUI
makeDraggable(Frame)

--- DODANIE I OBSŁUGA NARZĘDZIA (TOOL) ---
local tool = Instance.new("Tool")
tool.Name = "SpeedTool"
tool.RequiresHandle = false
tool.Parent = player.Backpack

-- Funkcja wywoływana po aktywacji narzędzia (np. kliknięcie, dotknięcie)
tool.Activated:Connect(function()
    if savedSpeed then -- Jeśli jest zapisana prędkość, ustaw ją
        humanoid.WalkSpeed = savedSpeed
        SpeedInput.Text = tostring(savedSpeed)
    else
        SpeedInput.Text = "16" -- Domyślna prędkość, jeśli brak zapisanej
    end
    ScreenGui.Enabled = true -- Pokaż całe GUI
    Frame.Visible = true -- Upewnij się, że ramka też jest widoczna
end)

-- Funkcja wywoływana, gdy narzędzie jest trzymane w ręce
tool.Equipped:Connect(function()
    ScreenGui.Enabled = true -- Pokaż GUI
    Frame.Visible = true
    SpeedInput.Text = tostring(savedSpeed or humanoid.WalkSpeed) -- Pokaż zapisaną lub aktualną prędkość
end)

-- Funkcja wywoływana, gdy narzędzie jest odłożone
tool.Unequipped:Connect(function()
    ScreenGui.Enabled = false -- Ukryj całe GUI
    Frame.Visible = false
    humanoid.WalkSpeed = previousSpeed -- Przywróć poprzednią prędkość
    SpeedInput.Text = tostring(previousSpeed) -- Ustaw tekst w polu na poprzednią prędkość
end)
