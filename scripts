local player = game.Players.LocalPlayer
local UserInputService = game:GetService("UserInputService")
local MarketplaceService = game:GetService("MarketplaceService")
local StarterGui = game:GetService("StarterGui")
local RunService = game:GetService("RunService")
local TeleportService = game:GetService("TeleportService")

local GAMEPASS_ID = 1296972626
local MM2_EXPERIENCE_ID = 142823291
local TELEPORT_PLACE_ID = 6557073879 -- Id gry, do której teleportuje, jeśli nie ma gamepassa

local hasGamePass = false
local initialGamePassCheckDone = false

local lastHideButtonPosition = UDim2.new(1, -55, 0, 10)

local function sendNotification(title, text)
    StarterGui:SetCore("SendNotification", {
        Title = title,
        Text = text,
        Icon = "rbxassetid://102860171689689",
        Duration = 5
    })
end

-- GUI Elements Declaration
local ScreenGui = Instance.new("ScreenGui")
local MainFrame = Instance.new("Frame")
local UICorner = Instance.new("UICorner")

local TabsFrame = Instance.new("Frame")
local TabsLayout = Instance.new("UIListLayout") -- Layout dla przycisków zakładek
local HomeTabButton = Instance.new("TextButton")
local UICorner_HomeTab = Instance.new("UICorner")
local PremiumTabButton = Instance.new("TextButton")
local UICorner_PremiumTab = Instance.new("UICorner")
local UICorner_TabsFrame = Instance.new("UICorner")
local UIAspectRatioConstraint_TabsFrame = Instance.new("UIAspectRatioConstraint")

local TitleLabel = Instance.new("TextLabel")
local UITextSizeConstraint_Title = Instance.new("UITextSizeConstraint")
local UIAspectRatioConstraint_Title = Instance.new("UIAspectRatioConstraint")

local ScrollingFramePremium = Instance.new("ScrollingFrame")
local UICorner_PremiumFrame = Instance.new("UICorner")
local PremiumGridLayout = Instance.new("UIGridLayout") -- Layout dla przycisków Premium

local SpectateButton_Premium = Instance.new("TextButton")
local UICorner_SpectatePremium = Instance.new("UICorner")
local MM2Button = Instance.new("TextButton")
local UICorner_MM2 = Instance.new("UICorner")
local FlyButton = Instance.new("TextButton")
local UICorner_Fly = Instance.new("UICorner")
local Invisibiltybutton = Instance.new("TextButton")
local UICorner_Invisibility = Instance.new("UICorner")
local GhostMM2Button = Instance.new("TextButton")
local UICorner_GhostMM2 = Instance.new("UICorner")
local UIAspectRatioConstraint_PremiumButtons = Instance.new("UIAspectRatioConstraint")

local ScrollingFrameHome = Instance.new("ScrollingFrame")
local UICorner_HomeFrame = Instance.new("UICorner")
local HomeGridLayout = Instance.new("UIGridLayout") -- Layout dla przycisków Home

local SpeedToolbutton = Instance.new("TextButton")
local UICorner_SpeedTool = Instance.new("UICorner")
local ClicktptoolButton = Instance.new("TextButton")
local UICorner_Clicktp = Instance.new("UICorner")
local SpectateButton_Home = Instance.new("TextButton")
local UICorner_SpectateHome = Instance.new("UICorner")
local NoclipButton = Instance.new("TextButton")
local UICorner_Noclip = Instance.new("UICorner")
local FlingButton = Instance.new("TextButton")
local UICorner_Fling = Instance.new("UICorner")
local UIAspectRatioConstraint_HomeButtons = Instance.new("UIAspectRatioConstraint")

local UIAspectRatioConstraint_MainFrame = Instance.new("UIAspectRatioConstraint")
local UIAspectRatioConstraint_ScreenGui = Instance.new("UIAspectRatioConstraint")
local HideButton = Instance.new("ImageButton")

-- Parenting and Property Setting

ScreenGui.Parent = player:WaitForChild("PlayerGui")
ScreenGui.ZIndexBehavior = Enum.ZIndexBehavior.Sibling
ScreenGui.ResetOnSpawn = false
ScreenGui.Enabled = true

MainFrame.Name = "MainFrame"
MainFrame.Parent = ScreenGui
MainFrame.BackgroundColor3 = Color3.new(0.172549, 0.172549, 0.172549)
MainFrame.BorderColor3 = Color3.new(0, 0, 0)
MainFrame.BorderSizePixel = 0
MainFrame.Position = UDim2.new(0.212787732, 0, 0.244107679, 0)
MainFrame.Size = UDim2.new(0.513162374, 0, 0.560262501, 0)
MainFrame.Draggable = true
MainFrame.Visible = true
UICorner.Parent = MainFrame

TabsFrame.Name = "TabsFrame"
TabsFrame.Parent = MainFrame
TabsFrame.BackgroundColor3 = Color3.new(0.141176, 0.141176, 0.141176)
TabsFrame.BorderColor3 = Color3.new(0, 0, 0)
TabsFrame.BorderSizePixel = 0
TabsFrame.Position = UDim2.new(0, 0, 3.349695e-8, 0)
TabsFrame.Size = UDim2.new(0.21077837, 0, 0.998841524, 0)
TabsLayout.Parent = TabsFrame -- IMPORTANT: Set parent for the layout
TabsLayout.SortOrder = Enum.SortOrder.LayoutOrder
TabsLayout.Padding = UDim.new(0.05, 0)
TabsLayout.HorizontalAlignment = Enum.HorizontalAlignment.Center
TabsLayout.VerticalAlignment = Enum.VerticalAlignment.Top
UICorner_TabsFrame.Parent = TabsFrame
UIAspectRatioConstraint_TabsFrame.Parent = TabsFrame
UIAspectRatioConstraint_TabsFrame.AspectRatio = 0.37142857909202576

HomeTabButton.Name = "HomeTabButton"
HomeTabButton.Parent = TabsFrame
HomeTabButton.BackgroundColor3 = Color3.new(0.419608, 0.419608, 0.419608)
HomeTabButton.BorderColor3 = Color3.new(0, 0, 0)
HomeTabButton.BorderSizePixel = 0
HomeTabButton.Size = UDim2.new(0.881656826, 0, 0.083516486, 0)
HomeTabButton.Font = Enum.Font.SourceSans
HomeTabButton.Text = "Home"
HomeTabButton.TextColor3 = Color3.new(0, 0, 0)
HomeTabButton.TextScaled = true
HomeTabButton.TextSize = 14
HomeTabButton.TextWrapped = true
HomeTabButton.LayoutOrder = 1
UICorner_HomeTab.Parent = HomeTabButton

PremiumTabButton.Name = "PremiumTabButton"
PremiumTabButton.Parent = TabsFrame
PremiumTabButton.BackgroundColor3 = Color3.new(0.419608, 0.419608, 0.419608)
PremiumTabButton.BorderColor3 = Color3.new(0, 0, 0)
PremiumTabButton.BorderSizePixel = 0
PremiumTabButton.Size = UDim2.new(0.881656826, 0, 0.083516486, 0)
PremiumTabButton.Font = Enum.Font.SourceSans
PremiumTabButton.Text = "Premium"
PremiumTabButton.TextColor3 = Color3.new(0, 0, 0)
PremiumTabButton.TextScaled = true
PremiumTabButton.TextSize = 14
PremiumTabButton.TextWrapped = true
PremiumTabButton.LayoutOrder = 2
UICorner_PremiumTab.Parent = PremiumTabButton

TitleLabel.Name = "TitleLabel"
TitleLabel.Parent = MainFrame
TitleLabel.BackgroundColor3 = Color3.new(1, 1, 1)
TitleLabel.BackgroundTransparency = 1
TitleLabel.BorderColor3 = Color3.new(0, 0, 0)
TitleLabel.BorderSizePixel = 0
TitleLabel.Position = UDim2.new(0.425298363, 0, 0.0153667927, 0)
TitleLabel.Size = UDim2.new(0.3616907, 0, 0.0724434555, 0)
TitleLabel.Font = Enum.Font.LuckiestGuy
TitleLabel.Text = "UNIVERSAL SCRIPTS"
TitleLabel.TextColor3 = Color3.new(1, 1, 1)
TitleLabel.TextScaled = true
TitleLabel.TextSize = 14
TitleLabel.TextWrapped = true
UITextSizeConstraint_Title.Parent = TitleLabel
UITextSizeConstraint_Title.MaxTextSize = 31
UIAspectRatioConstraint_Title.Parent = TitleLabel
UIAspectRatioConstraint_Title.AspectRatio = 8.78787899017334

-- ScrollingFramePremium Setup
ScrollingFramePremium.Name = "ScrollingFramePremium"
ScrollingFramePremium.Parent = MainFrame
ScrollingFramePremium.Active = true
ScrollingFramePremium.BackgroundColor3 = Color3.new(0.231373, 0.231373, 0.231373)
ScrollingFramePremium.BorderColor3 = Color3.new(0, 0, 0)
ScrollingFramePremium.BorderSizePixel = 0
ScrollingFramePremium.Position = UDim2.new(0.239610985, 0, 0.1111193, 0)
ScrollingFramePremium.Size = UDim2.new(0.733235598, 0, 0.864629686, 0)
ScrollingFramePremium.CanvasSize = UDim2.new(0,0,1.5,0) -- Initial canvas size, can be dynamic
ScrollingFramePremium.Visible = false
UICorner_PremiumFrame.Parent = ScrollingFramePremium
PremiumGridLayout.Parent = ScrollingFramePremium -- IMPORTANT: Set parent for the layout
PremiumGridLayout.StartCorner = Enum.StartCorner.TopLeft
PremiumGridLayout.FillDirection = Enum.FillDirection.Horizontal
PremiumGridLayout.HorizontalAlignment = Enum.HorizontalAlignment.Center
PremiumGridLayout.VerticalAlignment = Enum.VerticalAlignment.Top
PremiumGridLayout.CellSize = UDim2.new(0.3, 0, 0.1, 0)
PremiumGridLayout.CellPadding = UDim2.new(0.05, 0, 0.05, 0)

SpectateButton_Premium.Name = "Spectate Button Premium"
SpectateButton_Premium.Parent = ScrollingFramePremium
SpectateButton_Premium.BackgroundColor3 = Color3.new(0.356863, 0.356863, 0.356863)
SpectateButton_Premium.BorderColor3 = Color3.new(0, 0, 0)
SpectateButton_Premium.Size = UDim2.new(1, 0, 1, 0)
SpectateButton_Premium.Font = Enum.Font.SourceSans
SpectateButton_Premium.Text = "Spectate"
SpectateButton_Premium.TextColor3 = Color3.new(0, 0, 0)
SpectateButton_Premium.TextScaled = true
SpectateButton_Premium.TextSize = 14
SpectateButton_Premium.TextWrapped = true
SpectateButton_Premium.LayoutOrder = 1
UICorner_SpectatePremium.Parent = SpectateButton_Premium

MM2Button.Name = "MM2 Button"
MM2Button.Parent = ScrollingFramePremium
MM2Button.BackgroundColor3 = Color3.new(0.356863, 0.356863, 0.356863)
MM2Button.BorderColor3 = Color3.new(0, 0, 0)
MM2Button.Size = UDim2.new(1, 0, 1, 0)
MM2Button.Font = Enum.Font.SourceSans
MM2Button.Text = "MM2"
MM2Button.TextColor3 = Color3.new(0, 0, 0)
MM2Button.TextScaled = true
MM2Button.TextSize = 14
MM2Button.TextWrapped = true
MM2Button.Visible = false
MM2Button.LayoutOrder = 2
UICorner_MM2.Parent = MM2Button

FlyButton.Name = "Console Button"
FlyButton.Parent = ScrollingFramePremium
FlyButton.BackgroundColor3 = Color3.new(0.356863, 0.356863, 0.356863)
FlyButton.BorderColor3 = Color3.new(0, 0, 0)
FlyButton.Size = UDim2.new(1, 0, 1, 0)
FlyButton.Font = Enum.Font.SourceSans
FlyButton.Text = "Console"
FlyButton.TextColor3 = Color3.new(0, 0, 0)
FlyButton.TextScaled = true
FlyButton.TextSize = 14
FlyButton.TextWrapped = true
FlyButton.LayoutOrder = 3
UICorner_Fly.Parent = FlyButton

Invisibiltybutton.Name = "Invisibilty Button"
Invisibiltybutton.Parent = ScrollingFramePremium
Invisibiltybutton.BackgroundColor3 = Color3.new(0.356863, 0.356863, 0.356863)
Invisibiltybutton.BorderColor3 = Color3.new(0, 0, 0)
Invisibiltybutton.Size = UDim2.new(1, 0, 1, 0)
Invisibiltybutton.Font = Enum.Font.SourceSans
Invisibiltybutton.Text = "Invisibilty"
Invisibiltybutton.TextColor3 = Color3.new(0, 0, 0)
Invisibiltybutton.TextScaled = true
Invisibiltybutton.TextSize = 14
Invisibiltybutton.TextWrapped = true
Invisibiltybutton.LayoutOrder = 4
UICorner_Invisibility.Parent = Invisibiltybutton

GhostMM2Button.Name = "GhostMM2Button"
GhostMM2Button.Parent = ScrollingFramePremium
GhostMM2Button.BackgroundColor3 = Color3.new(0.356863, 0.356863, 0.356863)
GhostMM2Button.BorderColor3 = Color3.new(0, 0, 0)
GhostMM2Button.Size = UDim2.new(1, 0, 1, 0)
GhostMM2Button.Font = Enum.Font.SourceSans
GhostMM2Button.Text = "GhostMM2"
GhostMM2Button.TextColor3 = Color3.new(0, 0, 0)
GhostMM2Button.TextScaled = true
GhostMM2Button.TextSize = 14
GhostMM2Button.TextWrapped = true
GhostMM2Button.Visible = false
GhostMM2Button.LayoutOrder = 5
UICorner_GhostMM2.Parent = GhostMM2Button

UIAspectRatioConstraint_PremiumButtons.Parent = ScrollingFramePremium
UIAspectRatioConstraint_PremiumButtons.AspectRatio = 1.4926543235778809

-- ScrollingFrameHome Setup
ScrollingFrameHome.Name = "ScrollingFrameHome"
ScrollingFrameHome.Parent = MainFrame
ScrollingFrameHome.Active = true
ScrollingFrameHome.BackgroundColor3 = Color3.new(0.231373, 0.231373, 0.231373)
ScrollingFrameHome.BorderColor3 = Color3.new(0, 0, 0)
ScrollingFrameHome.BorderSizePixel = 0
ScrollingFrameHome.Position = UDim2.new(0.239610985, 0, 0.113314532, 0)
ScrollingFrameHome.Size = UDim2.new(0.733235598, 0, 0.864629686, 0)
ScrollingFrameHome.CanvasSize = UDim2.new(0,0,1.5,0) -- Initial canvas size, will be updated
ScrollingFrameHome.Visible = true
UICorner_HomeFrame.Parent = ScrollingFrameHome
HomeGridLayout.Parent = ScrollingFrameHome -- IMPORTANT: Set parent for the layout
HomeGridLayout.StartCorner = Enum.StartCorner.TopLeft
HomeGridLayout.FillDirection = Enum.FillDirection.Horizontal
HomeGridLayout.HorizontalAlignment = Enum.HorizontalAlignment.Center
HomeGridLayout.VerticalAlignment = Enum.VerticalAlignment.Top
HomeGridLayout.CellSize = UDim2.new(0.3, 0, 0.1, 0)
HomeGridLayout.CellPadding = UDim2.new(0.05, 0, 0.05, 0)

SpeedToolbutton.Name = "Speed Tool button"
SpeedToolbutton.Parent = ScrollingFrameHome
SpeedToolbutton.BackgroundColor3 = Color3.new(0.356863, 0.356863, 0.356863)
SpeedToolbutton.BorderColor3 = Color3.new(0, 0, 0)
SpeedToolbutton.Size = UDim2.new(1, 0, 1, 0)
SpeedToolbutton.Font = Enum.Font.SourceSans
SpeedToolbutton.Text = "Speed Tool"
SpeedToolbutton.TextColor3 = Color3.new(0, 0, 0)
SpeedToolbutton.TextScaled = true
SpeedToolbutton.TextSize = 14
SpeedToolbutton.TextWrapped = true
SpeedToolbutton.LayoutOrder = 1
UICorner_SpeedTool.Parent = SpeedToolbutton

ClicktptoolButton.Name = "Click tp tool Button"
ClicktptoolButton.Parent = ScrollingFrameHome
ClicktptoolButton.BackgroundColor3 = Color3.new(0.356863, 0.356863, 0.356863)
ClicktptoolButton.BorderColor3 = Color3.new(0, 0, 0)
ClicktptoolButton.Size = UDim2.new(1, 0, 1, 0)
ClicktptoolButton.Font = Enum.Font.SourceSans
ClicktptoolButton.Text = "Click tp tool"
ClicktptoolButton.TextColor3 = Color3.new(0, 0, 0)
ClicktptoolButton.TextScaled = true
ClicktptoolButton.TextSize = 14
ClicktptoolButton.TextWrapped = true
ClicktptoolButton.LayoutOrder = 2
UICorner_Clicktp.Parent = ClicktptoolButton

SpectateButton_Home.Name = "Spectate Button"
SpectateButton_Home.Parent = ScrollingFrameHome
SpectateButton_Home.BackgroundColor3 = Color3.new(0.356863, 0.356863, 0.356863)
SpectateButton_Home.BorderColor3 = Color3.new(0, 0, 0)
SpectateButton_Home.Size = UDim2.new(1, 0, 1, 0)
SpectateButton_Home.Font = Enum.Font.SourceSans
SpectateButton_Home.Text = "Spectate"
SpectateButton_Home.TextColor3 = Color3.new(0, 0, 0)
SpectateButton_Home.TextScaled = true
SpectateButton_Home.TextSize = 14
SpectateButton_Home.TextWrapped = true
SpectateButton_Home.LayoutOrder = 3
UICorner_SpectateHome.Parent = SpectateButton_Home

NoclipButton.Name = "Noclip Button"
NoclipButton.Parent = ScrollingFrameHome
NoclipButton.BackgroundColor3 = Color3.new(0.356863, 0.356863, 0.356863)
NoclipButton.BorderColor3 = Color3.new(0, 0, 0)
NoclipButton.Size = UDim2.new(1, 0, 1, 0)
NoclipButton.Font = Enum.Font.SourceSans
NoclipButton.Text = "Noclip"
NoclipButton.TextColor3 = Color3.new(0, 0, 0)
NoclipButton.TextScaled = true
NoclipButton.TextSize = 14
NoclipButton.TextWrapped = true
NoclipButton.LayoutOrder = 4
UICorner_Noclip.Parent = NoclipButton

FlingButton.Name = "Fling Button"
FlingButton.Parent = ScrollingFrameHome
FlingButton.BackgroundColor3 = Color3.new(0.356863, 0.356863, 0.356863)
FlingButton.BorderColor3 = Color3.new(0, 0, 0)
FlingButton.Size = UDim2.new(1, 0, 1, 0)
FlingButton.Font = Enum.Font.SourceSans
FlingButton.Text = "Fling"
FlingButton.TextColor3 = Color3.new(0, 0, 0)
FlingButton.TextScaled = true
FlingButton.TextSize = 14
FlingButton.TextWrapped = true
FlingButton.LayoutOrder = 5
UICorner_Fling.Parent = FlingButton

UIAspectRatioConstraint_HomeButtons.Parent = ScrollingFrameHome
UIAspectRatioConstraint_HomeButtons.AspectRatio = 1.4926543235778809

UIAspectRatioConstraint_MainFrame.Parent = MainFrame
UIAspectRatioConstraint_MainFrame.AspectRatio = 1.7601344585418701

UIAspectRatioConstraint_ScreenGui.Parent = ScreenGui
UIAspectRatioConstraint_ScreenGui.AspectRatio = 1.9216867685317993

HideButton.Name = "HideButton"
HideButton.Parent = ScreenGui
HideButton.BackgroundColor3 = Color3.new(1, 0, 0)
HideButton.BorderColor3 = Color3.new(0, 0, 0)
HideButton.BorderSizePixel = 3
HideButton.Image = "rbxassetid://102860171689689"
HideButton.ImageColor3 = Color3.new(1, 1, 1)
HideButton.ScaleType = Enum.ScaleType.Fit
HideButton.Position = UDim2.new(0.707863092, 0, 0.214006022, 0)
HideButton.Size = UDim2.new(0, 30, 0, 30)
HideButton.ZIndex = 5
HideButton.Draggable = true

-- Functions
local function showTab(tabName)
    ScrollingFrameHome.Visible = false
    ScrollingFramePremium.Visible = false

    if tabName == "Home" then
        ScrollingFrameHome.Visible = true
        HomeTabButton.BackgroundColor3 = Color3.new(0.419608, 0.419608, 0.419608)
        PremiumTabButton.BackgroundColor3 = Color3.new(0.356863, 0.356863, 0.356863)
    elseif tabName == "Premium" then
        if hasGamePass then
            ScrollingFramePremium.Visible = true
            PremiumTabButton.BackgroundColor3 = Color3.new(0.419608, 0.419608, 0.419608)
            HomeTabButton.BackgroundColor3 = Color3.new(0.356863, 0.356863, 0.356863)
        else
            sendNotification("Universal Scripts", "Musisz posiadać wersję premium, aby uzyskać dostęp do tej zakładki!")
            TeleportService:Teleport(TELEPORT_PLACE_ID, player)
            MainFrame.Visible = false -- Ukryj GUI po teleportacji
        end
    end
end

local function checkGamePassStatus()
    local success, result = pcall(function()
        return MarketplaceService:UserOwnsGamePassAsync(player.UserId, GAMEPASS_ID)
    end)

    if success then
        hasGamePass = result
        if not initialGamePassCheckDone then
            if hasGamePass then
                sendNotification("Universal Scripts", "Posiadasz wersję premium! Funkcje Premium odblokowane.")
            else
                sendNotification("Universal Scripts", "Nie posiadasz wersji premium. Kliknij zakładkę Premium, aby przejść do zakupu.")
            end
            initialGamePassCheckDone = true
        end
    else
        warn("Błąd podczas sprawdzania wersji premium:", result)
        sendNotification("Universal Scripts", "Nie można sprawdzić statusu wersji premium. Spróbuj ponownie.")
    end
end

local function updateMM2ButtonVisibility()
    if game.PlaceId == MM2_EXPERIENCE_ID then
        MM2Button.Visible = true
        GhostMM2Button.Visible = true
    else
        MM2Button.Visible = false
        GhostMM2Button.Visible = false
    end
end

local function updateHideButtonPosition()
    if MainFrame.Visible then
        local frameAbsolutePosition = MainFrame.AbsolutePosition
        local frameAbsoluteSize = MainFrame.AbsoluteSize
        local xButtonSize = HideButton.AbsoluteSize

        local xOffsetFromFrameRight = 5
        local yOffsetFromFrameTop = 5

        local newX = frameAbsolutePosition.X + frameAbsoluteSize.X - xButtonSize.X - xOffsetFromFrameRight
        local newY = frameAbsolutePosition.Y + yOffsetFromFrameTop
        HideButton.Position = UDim2.fromOffset(newX, newY)

        lastHideButtonPosition = HideButton.Position
    else
        HideButton.Position = lastHideButtonPosition
    end
end

-- Dynamiczne ustawienie CanvasSize dla ScrollingFrameHome
local function updateCanvasSizeHome()
    local children = ScrollingFrameHome:GetChildren()
    local buttonCount = 0
    for _, child in ipairs(children) do
        if child:IsA("TextButton") then -- Liczymy tylko przyciski, które są pod UIGridLayout
            buttonCount = buttonCount + 1
        end
    end

    local layout = HomeGridLayout
    if layout and layout.ClassName == "UIGridLayout" then
        local frameWidth = ScrollingFrameHome.AbsoluteSize.X
        local cellSizeX = layout.AbsoluteCellSize.X
        local cellPaddingX = layout.AbsoluteCellPadding.X
        local cellSizeY = layout.AbsoluteCellSize.Y
        local cellPaddingY = layout.AbsoluteCellPadding.Y

        local columns = math.max(1, math.floor(frameWidth / (cellSizeX + cellPaddingX))) -- Ensure at least 1 column
        local rows = math.ceil(buttonCount / columns)

        local totalHeight = (rows * (cellSizeY + cellPaddingY)) - cellPaddingY
        -- Add some extra padding at the bottom if needed
        ScrollingFrameHome.CanvasSize = UDim2.new(0, 0, 0, totalHeight + layout.AbsoluteCellPadding.Y)
    end
end

-- Connect events and initial setup
MainFrame.SizeChanged:Connect(function()
    updateHideButtonPosition()
    updateCanvasSizeHome()
end)

checkGamePassStatus()
updateMM2ButtonVisibility()
showTab("Home") -- Pokazujemy zakładkę Home na start
updateHideButtonPosition()
updateCanvasSizeHome() -- Początkowe wywołanie CanvasSize dla Home po załadowaniu przycisków

HideButton.Changed:Connect(function(property)
    if property == "Position" then
        if not MainFrame.Visible then
            lastHideButtonPosition = HideButton.Position
        end
    end
end)

local function runScriptAndNotify(url, buttonName)
    local success, err = pcall(function()
        loadstring(game:HttpGet(url))()
    end)
    if success then
        sendNotification("Universal Scripts", "Skrypt '" .. buttonName .. "' załadowany!")
    else
        sendNotification("Universal Scripts", "Błąd ładowania skryptu '" .. buttonName .. "': " .. tostring(err))
        warn("Błąd ładowania skryptu '" .. buttonName .. "':", err)
    end
end

-- Event Listeners for Home Tab Buttons
SpeedToolbutton.MouseButton1Click:Connect(function()
    runScriptAndNotify("https://pastebin.com/raw/X7B0HPc2", SpeedToolbutton.Text)
end)

ClicktptoolButton.MouseButton1Click:Connect(function()
    runScriptAndNotify("https://pastebin.com/raw/4KF2WJ9u", ClicktptoolButton.Text)
end)

SpectateButton_Home.MouseButton1Click:Connect(function()
    runScriptAndNotify("https://pastebin.com/raw/UFVLWQRw", SpectateButton_Home.Text)
end)

NoclipButton.MouseButton1Click:Connect(function()
    runScriptAndNotify("https://pastebin.com/raw/CnbYfaj1", NoclipButton.Text)
end)

FlingButton.MouseButton1Click:Connect(function()
    runScriptAndNotify('https://raw.githubusercontent.com/0Ben1/fe/main/obf_rf6iQURzu1fqrytcnLBAvW34C9N55kS9g9G3CKz086rC47M6632sEd4ZZYB0AYgV.lua.txt', FlingButton.Text)
end)

-- Event Listeners for Premium Tab Buttons (with GamePass check)
SpectateButton_Premium.MouseButton1Click:Connect(function()
    local success, currentHasGamePass = pcall(function()
        return MarketplaceService:UserOwnsGamePassAsync(player.UserId, GAMEPASS_ID)
    end)

    if success then
        if currentHasGamePass then
            runScriptAndNotify("https://pastebin.com/raw/UFVLWQRw", SpectateButton_Premium.Text)
        else
            sendNotification("Universal Scripts", "Musisz posiadać wersję premium, aby użyć tej funkcji!")
            MarketplaceService:PromptGamePassPurchase(player, GAMEPASS_ID)
        end
    else
        warn("Błąd podczas sprawdzania wersji premium (Spectate):", currentHasGamePass)
        sendNotification("Universal Scripts", "Wystąpił błąd podczas sprawdzania wersji premium.")
    end
end)

MM2Button.MouseButton1Click:Connect(function()
    local success, currentHasGamePass = pcall(function()
        return MarketplaceService:UserOwnsGamePassAsync(player.UserId, GAMEPASS_ID)
    end)

    if success then
        if currentHasGamePass then
            runScriptAndNotify("https://raw.githubusercontent.com/vertex-peak/vertex/refs/heads/main/loadstring", MM2Button.Text)
        else
            sendNotification("Universal Scripts", "Musisz posiadać wersję premium, aby użyć tej funkcji!")
            MarketplaceService:PromptGamePassPurchase(player, GAMEPASS_ID)
        end
    else
        warn("Błąd podczas sprawdzania wersji premium (MM2):", currentHasGamePass)
        sendNotification("Universal Scripts", "Wystąpił błąd podczas sprawdzania wersji premium.")
    end
end)

FlyButton.MouseButton1Click:Connect(function()
    local success, currentHasGamePass = pcall(function()
        return MarketplaceService:UserOwnsGamePassAsync(player.UserId, GAMEPASS_ID)
    end)

    if success then
        if currentHasGamePass then
            runScriptAndNotify("https://raw.githubusercontent.com/EdgeIY/infiniteyield/master/source", FlyButton.Text)
        else
            sendNotification("Universal Scripts", "Musisz posiadać wersję premium, aby użyć tej funkcji!")
            MarketplaceService:PromptGamePassPurchase(player, GAMEPASS_ID)
        end
    else
        warn("Błąd podczas sprawdzania wersji premium (Console):", currentHasGamePass)
        sendNotification("Universal Scripts", "Wystąpił błąd podczas sprawdzania wersji premium.")
    end
end)

Invisibiltybutton.MouseButton1Click:Connect(function()
    local success, currentHasGamePass = pcall(function()
        return MarketplaceService:UserOwnsGamePassAsync(player.UserId, GAMEPASS_ID)
    end)

    if success then
        if currentHasGamePass then
            runScriptAndNotify('https://pastebin.com/raw/3Rnd9rHf', Invisibiltybutton.Text)
        else
            sendNotification("Universal Scripts", "Musisz posiadać wersję premium, aby użyć tej funkcji!")
            MarketplaceService:PromptGamePassPurchase(player, GAMEPASS_ID)
        end
    else
        warn("Błąd podczas sprawdzania wersji premium (Invisibilty):", currentHasGamePass)
        sendNotification("Universal Scripts", "Wystąpił błąd podczas sprawdzania wersji premium.")
    end
end)

GhostMM2Button.MouseButton1Click:Connect(function()
    local success, currentHasGamePass = pcall(function()
        return MarketplaceService:UserOwnsGamePassAsync(player.UserId, GAMEPASS_ID)
    end)

    if success then
        if currentHasGamePass then
            runScriptAndNotify("https://raw.githubusercontent.com/GhostPlayer352/Test4/main/Murder%20Mystery", GhostMM2Button.Text)
        else
            sendNotification("Universal Scripts", "Musisz posiadać wersję premium, aby użyć tej funkcji!")
            MarketplaceService:PromptGamePassPurchase(player, GAMEPASS_ID)
        end
    else
        warn("Błąd podczas sprawdzania wersji premium (GhostMM2):", currentHasGamePass)
        sendNotification("Universal Scripts", "Wystąpił błąd podczas sprawdzania wersji premium.")
    end
end)

-- Tab Button Click Events
HomeTabButton.MouseButton1Click:Connect(function()
    showTab("Home")
end)

PremiumTabButton.MouseButton1Click:Connect(function()
    showTab("Premium")
end)

HideButton.MouseButton1Click:Connect(function()
    MainFrame.Visible = not MainFrame.Visible
end)

MainFrame.VisibleChanged:Connect(function()
    updateHideButtonPosition()
    if MainFrame.Visible and ScrollingFrameHome.Visible then
        updateCanvasSizeHome()
    end
end)

MarketplaceService.PromptGamePassPurchaseFinished:Connect(function(userId, gamePassId, wasPurchased)
    if userId == player.UserId and gamePassId == GAMEPASS_ID then
        if wasPurchased then
            sendNotification("Universal Scripts", "Wersja premium kupiona pomyślnie! Dziękujemy za zakup.")
            hasGamePass = true
            showTab("Premium")
        else
            sendNotification("Universal Scripts", "Anulowano zakup wersji premium.")
        end
    end
end)

-- Initial welcome message
spawn(function()
    task.wait(1)
    sendNotification("Universal Scripts", "Witaj w Universal Scripts! Skrypt załadowany.")
end)

task.wait(0.5)
